{% extends "django_sb_admin/base.html" %}
<!doctype html>
{% block sb_admin_header %}
  {% block branding %}
    <img src="/static/Riyadh-metro-logo.png" style="background: transparent;width: 60px;">
    <!-- <h1 id="site-name">Asset Optima</h1> -->
  {% endblock %}
{% endblock sb_admin_header %}
{% block sb_admin_content %}
              <!-- Page Heading -->

            <div class="row mb-3">
                <div class="col-lg-12">
                    <h3 class="page-header">
                        {% if data.id != '' %}
                        Update System Level RAM Targets
                        {% else %}
                        Add System Level RAM Targets
                        {% endif %}
                    </h3>
                    <!--ol class="breadcrumb">
                        <li>
                            <i class="fa fa-dashboard"></i>  <a href="index.html">Dashboard</a>
                        </li>
                        <li class="active">
                            <i class="fa fa-edit"></i> Forms
                        </li>
                    </ol-->
                </div>
            </div>

            <div class="row ">
                <div class="col-lg-12 mb-3">
    
    
                    <a href="/manageSystem/"><button class="btn btn-primary btn-icon-split float-right m-2" > 
                    <span class="icon text-white-50">
                        <i class="fas fa-angle-left"></i>
                        </span>             
                    <span class="text">Back</span>
                    </button></a>
                
                </div>
            </div>

            <!-- /.row -->
           <form id="ProjectForm"> 
            {% if request.session.user_Role == 1 %}
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="product_name">*Project_name:</label>
                            <input type="hidden" id="id" name="id" value="{{data.id}}">
                            <select class="form-control" id="project" name="project" required="required" >
                            <option value="">--  Select Project  --</option>
                            {% for project in project %}
                            {% if project.product_id != '' %}
                                {% if project.product_id == data.project %}
                                        <option value="{{project.product_id}}" selected>{{project.product_name}}</option>
                                {% else %}
                                    <option value="{{project.product_id}}" >{{project.product_name}}</option>
                                {% endif %}
                            {% endif %}
                            {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="system">*System:</label>
                            <select class="form-control" id="system" name="system" required="required">
                            </select>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="MTBF">*MTBF ({{MTBFMTBSAF}}):</label>
                            <input type="number" step="0.001" class="form-control" id="MTBF" value="{{data.MTBF}}" name="MTBF" required="required">
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="MTBSAF">*MTBSAF ({{MTBFMTBSAF}}):</label>
                            <input type="number" step="0.001" class="form-control" id="MTBSAF" value="{{data.MTBSAF}}" name="MTBSAF" required="required">
                        </div>
                    </div>
                

                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="MTTR">*MTTR ({{MTTR}}):</label>
                            <input type="number" step="0.001" class="form-control" id="MTTR" name="MTTR" value="{{data.MTTR}}" required="required">
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="availability_target">*Availability target:</label>
                            <input type="number" step="0.001" class="form-control" id="availability_target" name="availability_target" value="{{data.availability_target}}" required="required">
                        </div>
                    </div>
                    
                
                
                </div>
            {% else %}  
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="product_name">*product_name:</label>
                            <input type="hidden" id="id" name="id" value="{{data.id}}">
                            <input type="hidden" id="product_name" name="product_name" value="{{data.product_name}}">
                            <label class="form-control">{{data.product_name}}</label>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="System">*System:</label>
                            <label class="form-control">{{data.System}}</label>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="MTBF">*MTBF ({{MTBFMTBSAF}}):</label>
                            <input type="number" step="0.001" class="form-control" id="MTBF" value="{{data.MTBF}}" name="MTBF" required="required">
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="MTBSAF">*MTBSAF ({{MTBFMTBSAF}}):</label>
                            <input type="number" step="0.001" class="form-control" id="MTBSAF" value="{{data.MTBSAF}}" name="MTBSAF" required="required">
                        </div>
                    </div>
                

                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="MTTR">*MTTR ({{MTTR}}):</label>
                            <input type="number" step="0.001" class="form-control" id="MTTR" name="MTTR" value="{{data.MTTR}}" required="required">
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="availability_target">*Availability target:</label>
                            <input type="number" step="0.001" class="form-control" id="availability_target" name="availability_target" value="{{data.availability_target}}" required="required">
                        </div>
                    </div>
                    
                
                
                </div>
            {% endif %}   
           
           
            <div class="row ">
                <div class="alert alert-warning col-12 d-none" id="message">
                            
                </div>
            </div>

            <div class="row mb-4" align="right">
                <div class="col-12">  
                    <input type="hidden" id="buttonClick">   
                    <button type="submit" class="btn btn-primary mt-2" onClick="return SetButton(1);">Save</button>
                    
                    <button type="submit" class="btn btn-primary mt-2" onClick="return SetButton(2);">Save and add another</button>
                
                    <button type="submit" class="btn btn-primary mt-2" onClick="return SetButton(3);">Save and and continue editing</button>
                </div>
            </div>
        </form>
            
{% endblock sb_admin_content %}
{% block sb_admin_js %}
<script>
    $(document).ready(function() {
        var id= $('#id').val()
        if(id != ""){
            var project= $('select[name=project]').val()
            $.ajax({
              url: "/reports/project/",
              method: 'GET',
              dataType: 'json',
              headers: {'X-CSRFToken': '{{ csrf_token }}'},
              data : {
                'project' : project,
              },
              success: function (response) {
                    console.log(response);
                    var system = "<option value="+""+">"+"--All--"+"</options>";
                    $.each(response, function (i,value) {
                      if (value.system == '{{data.System}}'){
                        system = system + "<option value='"+value.system+"' selected>"+value.system+"</options>";
                        }else{
                            system = system + "<option value='"+value.system+"'>"+value.system+"</options>";
                        }
                  });
                    var select = "<select>"+system+"</select>";
                    $("#system").html(select);
                    
                  }
              });
        }
    });
    function SetButton(id){
        $('#buttonClick').val(id);
        return true;
    }

    $("#project").change(function () { 
        var project= $('select[name=project]').val()  
        $.ajax({
        url: "/reports/project/",
        method: 'GET',
        dataType: 'json',
        headers: {'X-CSRFToken': '{{ csrf_token }}'},
        data : {
            'project' : project,
        },
        success: function (response) {
                console.log(response);
                var system = "<option value="+""+">"+"--All--"+"</options>";
                $.each(response, function (i,value) {
                if (value.system != ''){
                    system = system + "<option value='"+ value.system +"'>"+value.system+"</options>";
                }
            });
                var select = "<select>"+system+"</select>";
                $("#system").html(select);
            
            }
        }); 
    });

    $( "#ProjectForm" ).submit(function(e) {
        e.preventDefault();
        var buttonClick= $('#buttonClick').val()
        var id= $('#id').val()
        var project= $('select[name=project] option').filter(':selected').val()
        var system= $('select[name=system] option').filter(':selected').val()
        var MTBF= $('#MTBF').val()
        var MTBSAF= $('#MTBSAF').val()
        var MTTR= $('#MTTR').val()
        var availability_target= $('#availability_target').val()

        $.ajax({
            url: "/Systemmanage/add/",
            method: 'POST',
            dataType: 'json',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            data : {
                'id':id,
                'project':project,
                'system':system,
                'MTBF':MTBF,
                'MTBSAF' : MTBSAF,
                'MTTR': MTTR,
                'availability_target' : availability_target,
            },

            success: function (response) {

                if(response.status == '1') {
                    if(id ==""){
                        if(buttonClick == 1){
                           
                            swal({
                                title: 'Successfully add System Level RAM Targets',
                                text: "",
                                type: '',
                                showCancelButton: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Ok'
                            },function () {
                                window.location.href = "/manageSystem/";
                            })  
                             
                        } 
                        else if(buttonClick == 2){
                          
                            swal({
                                title: 'Successfully add System Level RAM Targets',
                                text: "",
                                type: '',
                                showCancelButton: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Ok'
                            },function () {
                                window.location.href  = "/Systemmanage/add/";
                            })  

                        } 
                        else if(buttonClick == 3) {
                         
                            swal({
                                title: 'Successfully add System Level RAM Targets',
                                text: "",
                                type: '',
                                showCancelButton: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Ok'
                            },function () {
                                window.location.href = "/Systemmanage/add/"+response.id;
                            })  
                        }
                    }else{
                        if(buttonClick == 1){
                          
                            swal({
                                title: 'Successfully update System Level RAM Targets',
                                text: "",
                                type: '',
                                showCancelButton: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Ok'
                            },function () {
                                window.location.href = "/manageSystem/";
                            })  
                             
                        } 
                        else if(buttonClick == 2){
                            
                            swal({
                                title: 'Successfully update System Level RAM Targets',
                                text: "",
                                type: '',
                                showCancelButton: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Ok'
                            },function () {
                                window.location.href  = "/Systemmanage/add/";
                            })  
                        } 
                        else if(buttonClick == 3) {
                           
                            swal({
                                title: 'Successfully update System Level RAM Targets',
                                text: "",
                                type: '',
                                showCancelButton: false,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Ok'
                            },function () {
                                window.location.href = "/Systemmanage/add/"+response.id;
                            })  
                        }
                    }
                    
                }
                else{
                    swal('System already set System Level RAM Targets')
                   // $('#message').removeClass('d-none'); 
                    //$('#message').html('Asset config id already exists.');
                }
            }
        });
        
    });


</script>

{% endblock sb_admin_js %}
