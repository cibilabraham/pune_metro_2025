{% extends "django_sb_admin/base.html" %}
<!doctype html>
{% block sb_admin_header %}
  {% block branding %}
    <img src="/static/Riyadh-metro-logo.png" style="background: transparent;width: 60px;">
    <!-- <h1 id="site-name">Asset Optima</h1> -->
  {% endblock %}
{% endblock sb_admin_header %}
{% block sb_admin_content %}
              <!-- Page Heading -->

            <div class="row mb-3">
                <div class="col-lg-6">
                    <h3 class="page-header">
                       Job Card
                    </h3>
                  
                </div>

                 <div class="col-lg-6 mb-3">
    
    
                    <a href="/forms/jobcard_register/"><button class="btn btn-primary btn-icon-split float-right m-2" > 
                    <span class="icon text-white-50">
                        <i class="fas fa-angle-left"></i>
                        </span>             
                    <span class="text">Back</span>
                    </button></a>
                
                </div>

            </div>
            <div class="row " style="padding: 20px;">

                <div class="col-lg-6">
                    <span>Job Card No: <b>{{data.job_card_no}}</b></span><br>
                    <span>Train Set No: <b>{{data.train_set_no}}</b></span><br>
                    <span>Department: <b>{{data.department}}</b></span><br>
                    <span>Nature of Job: <b>{{ data.nature_of_job|default_if_none:"" }}</b></span><br>
                    <span>SIC Required: <b>{{ data.sic_required|default_if_none:"" }}</b></span><br>
                    <span>Assigned To: <b>
                        {% if data.run_status < 3 %}
                            Operator
                        {% elif data.run_status <= 6 %}
                            Maintainer
                        {% elif data.run_status == 7 %}
                            Operator
                        {% else %}
                            Operator
                        {% endif %}

                    </b></span><br>
                 
                  
                </div>
                <div class="col-lg-6">
                    <span>Date Issued <b>{{data.date}}</b></span>,
                    <span>Time <b>{{data.time}}</b></span><br>

                    {% if data.status == 0 %}
                        <h3 class="text-success"> Open </h3>
                    {% else %}
                        <h3 class="text-danger"> Closed </h3>
                    {% endif %}

                    <span>Last Update On <b>{{data.last_update}}</b></span>


                    
                </div>

               

               
            </div>


<hr>
             <div class="row " style="padding: 20px;">
                <div class="col-lg-12"><h3>Failure Data</h3></div>
                
                <div class="col-lg-4">
                    <span>Failure ID: <b>{{data.failure_id}}</b></span><br>
                    <span>Failure description: <b>{{data.event_description}}</b></span><br>
                    <span>Failure type: <b>{{data.failure_type}}</b></span><br><br>

                    <span>Kilometre Reading: <b>{{data.kilometre_reading}}</b></span><br>
                    <span>CAR: <b>{{data.sel_car}}</b></span><br>
                    <span>Equipment: <b>{{data.equipment}}</b></span><br>
                    <span>Location: <b>{{data.location}}</b></span><br>
                    <span>Direction: <b>{{data.direction}}</b></span><br>

                </div>

                <div class="col-lg-4">
                    <span>Asset Name: <b>{{data.asset_type}}</b></span><br>
                    <span>Asset Config ID: <b>{{data.asset_config_id}}</b></span><br>
                    <span>Train Set No: <b>{{data.train_set_no}}</b></span><br><br>
                    
                    <span>Incident: <b>{{data.incident}}</b></span><br>
                    <span>No. of Trips Cancelled: <b>{{data.no_of_trip_cancel}}</b></span><br>
                    <span>Deboarding: <b>{{data.deboarding}}</b></span><br>
                    <span>Reported to PPIO: <b>{{data.reported_to_PPIO}}</b></span><br>
                    <span>T.O. Name / Reported By: <b>{{data.TO_name}}</b></span><br>

                </div>
                <div class="col-lg-4">
                    <span>Failure detection: <b>{{data.detection}}</b></span><br>
                    <span>Delay Time (mins): <b>{{data.service_delay}}</b></span><br>
                    <span>Safety failure: <b>{{data.safety_failure}}</b></span><br><br>

                    <span>Cm start date : <b>{{data.cm_start_date}}</b></span><br>
                    <span>Cm start time: <b>{{data.cm_start_time}}</b></span><br>
                    <span>Cm end date : <b>{{data.cm_end_date}}</b></span><br>
                    <span>Cm end time: <b>{{data.cm_end_time}}</b></span><br>
                    <span>Cm description: <b>{{data.cm_description}}</b></span><br>

                </div>
                <div class="col-lg-12"><br>
                    <span>Immediate Action Taken: <b>{{data.immediate_investigation}}</b></span><br>
                </div>



             </div>

             <hr>
             

             {% if data.run_status == 0  %}

                {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                <div class="row " style="padding: 20px;text-align: center;">
                    <div class="col-lg-12 " >
                        <h5>LEVEL 1 Job Card Details (To be filled by PPIO) (Pune Metro)</h5>
                        
                    </div>

                </div>

                <form id="Level1JobCard"> 
                    <div class="row mb-4">


                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="ohe_required">*OHE Required :</label>
                                <select class="form-control" id="ohe_required " name="ohe_required" required="required">
                                    {% if 'Yes' == data.ohe_required %}
                                    <option value="Yes" selected>Yes</option>
                                    {% else %}
                                        <option value="Yes">Yes</option>
                                    {% endif %}
                                    {% if 'No' == data.ohe_required %}
                                    <option value="No" selected>No</option>
                                    {% else %}
                                        <option value="No">No</option>
                                    {% endif %}
                                </select>
                                {% comment %} <input type="text" class="form-control" id="ohe_required" name="ohe_required" value="{{data.ohe_required}}"> {% endcomment %}
                                <div class="invalid-feedback">
                                Please select OHE Required .
                                </div>
                            </div>
                        </div>


                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="issued_to">*Issued to:</label>
                                <input type="text" class="form-control" id="issued_to" required="required" name="issued_to" value="{{data.issued_to}}">
                                <div class="invalid-feedback">
                                Please enter Issued to.
                                </div>
                            </div>
                        </div>

                             <div class="col-md-4">
                            <div class="form-group">
                                <label for="completion_time">*Expected Time of Completion (hrs):</label>
                                <input type="number" class="form-control" required="required" id="completion_time" name="completion_time" value="{{data.completion_time}}">
                                <div class="invalid-feedback">
                                Please enter Expected Time of Completion.
                                </div>
                            </div>
                        </div>


                         <div class="col-md-4">
                            <div class="form-group">
                                <label for="from_revenue_service">*Train Withdrawn from Revenue Service :</label>
                                <select class="form-control" id="from_revenue_service " name="from_revenue_service" required="required" >
                                    {% if 'Yes' == data.from_revenue_service %}
                                    <option value="Yes" selected>Yes</option>
                                    {% else %}
                                        <option value="Yes">Yes</option>
                                    {% endif %}
                                    {% if 'No' == data.from_revenue_service %}
                                    <option value="No" selected>No</option>
                                    {% else %}
                                        <option value="No">No</option>
                                    {% endif %}
                                </select>
                                {% comment %} <input type="text" class="form-control" id="from_revenue_service" name="from_revenue_service" value="{{data.from_revenue_service}}"> {% endcomment %}
                                <div class="invalid-feedback">
                                Please select Train Withdrawn from Revenue Service .
                                </div>
                            </div>
                        </div>



                            <div class="col-md-4 " id="revenue_service_div1">
                                <div class="form-group">
                                    <label for="delay_to_service">Delay to Service (mins):</label>
                                    <input type="number" class="form-control" id="delay_to_service" name="delay_to_service" value="{{data.delay_to_service}}">
                                    <div class="invalid-feedback">
                                    Please enter Delay to Service.
                                    </div>
                                </div>
                            </div>


                            <div class="col-md-4 " id="revenue_service_div2">
                                <div class="form-group">
                                    <label for="trip_no">Trip No:</label>
                                    <input type="text" class="form-control" id="trip_no"  name="trip_no" value="{{data.trip_no}}">
                                    <div class="invalid-feedback">
                                    Please enter Trip No.
                                    </div>
                                </div>
                            </div>



                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="nature_of_job">Nature of Job:</label>
                                
                                    <select class="form-control" id="nature_of_job" name="nature_of_job" >
                                        <option value="" selected>Select Nature of Job</option>
                                        {% if 'Schedule Preventive Maintenance' == data.nature_of_job %}
                                        <option value="Schedule Preventive Maintenance" selected>Schedule Preventive Maintenance</option>
                                        {% else %}
                                            <option value="Schedule Preventive Maintenance">Schedule Preventive Maintenance</option>
                                        {% endif %}
                                        {% if 'Main Line Fault' == data.nature_of_job %}
                                        <option value="Main Line Fault" selected>Main Line Fault</option>
                                        {% else %}
                                            <option value="Main Line Fault">Main Line Fault</option>
                                        {% endif %}

                                        {% if 'Depot Fault' == data.nature_of_job %}
                                        <option value="Depot Fault" selected>Depot Fault</option>
                                        {% else %}
                                            <option value="Depot Fault">Depot Fault</option>
                                        {% endif %}

                                        {% if 'Cyclic Check' == data.nature_of_job %}
                                        <option value="Cyclic Check" selected>Cyclic Check</option>
                                        {% else %}
                                            <option value="Cyclic Check">Cyclic Check</option>
                                        {% endif %}

                                        {% if 'Overhaul' == data.nature_of_job %}
                                        <option value="Overhaul" selected>Overhaul</option>
                                        {% else %}
                                            <option value="Overhaul">Overhaul</option>
                                        {% endif %}
                                    
                                    </select>




                                    {% comment %} <input type="text" class="form-control" id="nature_of_job" name="nature_of_job" value="{{data.nature_of_job}}"> {% endcomment %}
                                    <div class="invalid-feedback">
                                    Please enter Nature of Job.
                                    </div>
                                </div>
                            </div>



                              <div class="col-md-4">
                                <div class="form-group">
                                    <label for="event_date">*Event Date (DD/MM/YYYY):</label>
                                    <input type="text" autocomplete="off" required="required" class="form-control date-time" id="event_date" name="event_date" value="{{data.event_date|date:'d/m/Y'}}">
                                    <div class="invalid-feedback">
                                    Please enter Event Date.
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="event_time">*Event Time:</label>
                                    <input type="time" class="form-control" id="event_time" required="required" name="event_time" value="{{data.event_time|date:"H:i"}}">
                                    <div class="invalid-feedback">
                                    Please enter Event Time.
                                    </div>
                                </div>
                            </div>


                             <div class="col-12">  
                                <button type="submit" class="btn btn-primary mt-2" >Update</button>

                            </div>








                    </div>



                </form>
                
                {% endif %}

            {% else %}

                {% if data.run_status > 0 %}


                    <div class="row " style="padding: 20px;">
                        <div class="col-lg-12"><h3>LEVEL 1 Job Card Details (To be filled by PPIO) (Pune Metro)</h3></div>

                        <div class="col-lg-4">
                            <span>OHE Required: <b>{{data.ohe_required}}</b></span><br>
                            <span>Issued to: <b>{{data.issued_to}}</b></span><br>

                            {% if data.completion_time %}
                            <span>Expected Time of Completion: <b>{{ data.completion_time }} hrs</b></span>
                            {% else %}
                            <span>Expected Time of Completion: <b>{{data.completion_time}} </b></span>
                            {% endif %}

                            <br><br>

                            <span>Train Withdrawn from Revenue Service: <b>{{data.from_revenue_service}}</b></span><br>

                            {% if data.delay_to_service %}
                            <span>Delay to Service: <b>{{ data.delay_to_service }} mins</b></span>
                            {% else %}
                            <span>Delay to Service: <b>{{data.delay_to_service}} </b></span>
                            {% endif %}

                            <br>
                            <span>Trip No: <b>{{data.trip_no}}</b></span><br>                 
                           



                        </div>
                        <div class="col-lg-4">

                            <span>Nature of Job: <b>{{data.nature_of_job}}</b></span><br>
                            <span>Event Date: <b>{{data.event_date}}</b></span><br>
                            <span>Event Time: <b>{{data.event_time}}</b></span><br>

                        </div>

                        {% if data.run_status < 3 %}

                        {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                        <div class="col-lg-4">
                            <input type="button" value="Edit LEVEL 1 Job Card Details" class="btn btn-primary" onClick="editJobCardDetails()">
                        </div>

                        {% endif %}

                        {% endif %}


                    </div>



                    {% if data.run_status == 1  %}

                        {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                    

                        <div class="row " style="padding: 20px;text-align: center;">
                            <div class="col-lg-12 " >
                                <h5>LEVEL 1 Details Of Job(s) to be carried out</h5>
                                
                            </div>

                            
                                {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                                    <div class="col-lg-12 " align="right">
                                        <input type="button" value="Add new Job Details" class="btn btn-primary" onClick="createNewJobDetails();">
                                    </div>

                                {% endif %}
                         

                        </div>



                         <div class="row " style="padding: 20px;text-align: center;">
                            <div class="col-md-12">
                                <table id="example" class="table stripe row-border order-column table-bordered" style="width:100%">
                                    <thead>
                                        <tr>
                                           
                                            <th>S. No</th>
                                            <th>Car No</th>
                                            <th>Sub System</th>
                                            <th>Equipment</th>
                                            <th>Job Details</th>
                                           
                                            <th class="bg-white">
                                                
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>


                                     {% for job_details in job_details %}
                                            <tr>
                                                <td>{{ job_details.s_no }}</td>
                                                <td>{{ data.sel_car }}</td>
                                                <td>{{ data.subsystem }}</td>
                                                <td>{{ data.equipment }}</td>
                                                <td>{{ job_details.job_description }}</td>

                                                
                                                <td class="bg-white">

                                                    {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                                        <input type="button" value="Edit" onClick="editJobDetails('{{ job_details.job_details_id }}',`{{ job_details.s_no }}`,`{{ job_details.job_description }}`);">

                                        <input type="button" value="Delete" onClick="deleteJobDetails('{{ job_details.job_details_id }}');">


                                                    {% endif %}

                                                </td>
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="6" class="text-center text-muted">No job details available</td>
                                            </tr>
                                        {% endfor %}

                                        





                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <form id="Level1SafetyIndependent">
                         <div class="row " style="padding: 20px;">


                             <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="safety_failure">Safety Independent Check Required :</label>
                                        <select class="form-control" id="sic_required " name="sic_required" >
                                            {% if 'Yes' == data.sic_required %}
                                            <option value="Yes" selected>Yes</option>
                                            {% else %}
                                                <option value="Yes">Yes</option>
                                            {% endif %}
                                            {% if 'No' == data.sic_required %}
                                            <option value="No" selected>No</option>
                                            {% else %}
                                                <option value="No">No</option>
                                            {% endif %}
                                        </select>
                                        {% comment %} <input type="text" class="form-control" id="sic_required" name="sic_required" value="{{data.safety_failure}}"> {% endcomment %}
                                        <div class="invalid-feedback">
                                        Please select Safety Independent Check Required .
                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="sic_no">SIC No:</label>
                                        <input type="text" class="form-control" id="sic_no"  name="sic_no" value="{{data.sic_no}}">
                                        <div class="invalid-feedback">
                                        Please enter SIC No.
                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="assigned_to">SIC Assigned:</label>
                                        <input type="text" class="form-control" id="assigned_to"  name="assigned_to" value="{{data.assigned_to}}">
                                        <div class="invalid-feedback">
                                        Please enter SIC Assigned.
                                        </div>
                                    </div>
                                </div>


                                <div class="col-12">  
                                    <button type="submit" class="btn btn-primary mt-2" >Update</button>

                                </div>
                                


                         </div>

                        </form>

                        {% endif %}


                    {% else %}

                        {% if data.run_status > 1 %}


                         <div class="row " style="padding: 20px;">
                             <div class="col-lg-12"><h3>LEVEL 1 Details Of Job(s) to be carried out</h3></div>
                            

                        </div>

                         <div class="row " style="padding: 20px;text-align: center;">
                            <div class="col-md-12">
                                <table id="example" class="table stripe row-border order-column table-bordered" style="width:100%">
                                    <thead>
                                        <tr>
                                           
                                            <th>S. No</th>
                                            <th>Car No</th>
                                            <th>Sub System</th>
                                            <th>Equipment</th>
                                            <th>Job Details</th>
                                         
                                        </tr>
                                    </thead>
                                    <tbody>


                                     {% for job_details in job_details %}
                                            <tr>
                                                <td>{{ job_details.s_no }}</td>
                                                <td>{{ data.sel_car }}</td>
                                                <td>{{ data.subsystem }}</td>
                                                <td>{{ data.equipment }}</td>
                                                <td>{{ job_details.job_description }}</td>

                                                
                                              
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="5" class="text-center text-muted">No job details available</td>
                                            </tr>
                                        {% endfor %}

                                        





                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="row " style="padding: 20px;">

                             <div class="col-lg-4">

                                    <span>Safety Independent Check Required: <b>{{data.sic_required}}</b></span><br>
                                    <span>SIC No: <b>{{data.sic_no}}</b></span><br>
                                    <span>SIC Assigned: <b>{{data.assigned_to}}</b></span><br>

                                </div>


                            {% if  data.run_status < 3 %}

                            {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                            <div class="col-lg-4">
                                <input type="button" value="Edit LEVEL 1 Details Of Job" class="btn btn-primary" onClick="editDetailsOfJob()">
                            </div>
                            {% endif %}
                            {% endif %}


                        </div>



                         <div class="row " style="padding: 20px;text-align: center;">

                            <h5>If any other Job Cards Issued for the same Train on the same day & same time</h5>
                            <div class="col-md-12">
                                <table  class="table stripe row-border order-column table-bordered" style="width:100%">
                                    <thead>
                                        <tr>
                                           
                                            <th>S. No</th>
                                            <th>Job Card No</th>
                                            <th>Job Card Issue To</th>
                                            <th>Activity</th>
                                            <th>Expected Completion Time (hrs)</th>
                                            <th>Status</th>
                                         
                                        </tr>
                                    </thead>
                                    <tbody>


                                     {% for prv_dts in prv_data %}
                                            <tr>
                                                <td>{{ prv_dts.st_gen }}</td>
                                                <td>{{ prv_dts.job_card_no }}</td>
                                                <td>{{ prv_dts.issued_to }}</td>
                                                <td>{{ prv_dts.immediate_investigation }}</td>
                                                <td>{{ prv_dts.completion_time }}</td>
                                                 <td>{{ prv_dts.status }}</td>

                                                
                                              
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="6" class="text-center text-muted">No job card available</td>
                                            </tr>
                                        {% endfor %}

                                        





                                    </tbody>
                                </table>
                            </div>
                        </div>



                        {% if data.run_status == 2  %}

                        {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}


                         <div class="row " style="padding: 20px;text-align: center;">
                            <div class="col-lg-12 " >
                                <h5>LEVEL 1 Previous Failure History (To be filled by PPIO) (Pune Metro)</h5>
                                
                            </div>

                           
                         

                        </div>


                         <div class="row " style="padding: 20px;text-align: center;">
                            <h5>Previous Failure History of the system or equipment for which this job cards is issued: if any</h5>
                            <div class="col-md-12">
                                <table  class="table stripe row-border order-column table-bordered" style="width:100%">
                                    <thead>
                                        <tr>
                                           
                                            <th>S. No</th>
                                            <th>Event Date</th>
                                            <th>Job Card No</th>
                                            <th>Action Taken</th>
                                           
                                         
                                        </tr>
                                    </thead>
                                    <tbody>


                                     {% for prv_dts in prv_data2 %}
                                            <tr>
                                                <td>{{ prv_dts.st_gen }}</td>
                                                <td>{{ prv_dts.date }}</td>
                                                <td>{{ prv_dts.job_card_no }}</td>
                                                <td>{{ prv_dts.immediate_investigation }}</td>
                                              
                                                
                                              
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="6" class="text-center text-muted">No job card available</td>
                                            </tr>
                                        {% endfor %}

                                        





                                    </tbody>
                                </table>
                            </div>
                        </div>


                         <form id="Level1FinalForm">
                         <div class="row " style="padding: 20px;">


                           

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="issued_by">*Issued by (Name): </label>
                                        <input type="text" class="form-control" id="issued_by"  name="issued_by" value="{{data.issued_by}}" required="required" readonly>
                                        <div class="invalid-feedback">
                                        Please enter Issued by (Name).
                                        </div>
                                    </div>
                                </div>

                                 <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="issued_signature">*Designation / EMP ID: </label>
                                        <input type="text" class="form-control" id="issued_signature"  name="issued_signature" value="{{data.issued_signature}}" required="required" readonly>
                                        <div class="invalid-feedback">
                                        Please enter Designation / EMP ID.
                                        </div>
                                    </div>
                                </div>





                                <div class="col-md-4 hide d-none">
                                    <div class="form-group">
                                        <label for="signature_img">*Signature: </label>
                                        <input type="file" class="form-control" id="signature_img"  name="signature_img" accept="image/*">
                                        <div class="invalid-feedback">
                                        Please upload Signature.
                                        </div>
                                    </div>
                                </div>


                                    
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="l1_date">*Date (DD/MM/YYYY):</label>
                                        <input type="text" autocomplete="off" required="required" class="form-control date-time" id="l1_date" name="l1_date" value="{{data.l1_date|date:'d/m/Y'}}">
                                        <div class="invalid-feedback">
                                        Please enter Date.
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="l1_time">*Time:</label>
                                        <input type="time" class="form-control" id="l1_time" required="required" name="l1_time" value="{{data.l1_time|date:"H:i"}}">
                                        <div class="invalid-feedback">
                                        Please enter Time.
                                        </div>
                                    </div>
                                </div>


                                <div class="col-12">  
                                    <button type="submit" class="btn btn-primary mt-2" >Update</button>

                                </div>
                                


                         </div>

                        </form>
                        {% endif %}

                        {% else %}

                            {% if data.run_status > 2 %}


                              <div class="row " style="padding: 20px;">
                                    <div class="col-lg-12"><h3>LEVEL 1 Previous Failure History (To be filled by PPIO) (Pune Metro)</h3></div>


                                    {% if request.session.user_Role == 1 or request.session.user_Role == 2 %}   

                                    <div class="col-lg-4">
                                        <input type="button" value="Edit LEVEL 1 Previous Failure History" class="btn btn-primary" onClick="Level1FinalFormRelease()">
                                    </div>

                                    {% endif %}





                                    

                                </div>




                                <div class="row " style="padding: 20px;text-align: center;">
                                    <h5>Previous Failure History of the system or equipment for which this job cards is issued: if any</h5>
                                    <div class="col-md-12">
                                                <table  class="table stripe row-border order-column table-bordered" style="width:100%">
                                                <thead>
                                                    <tr>
                                                    
                                                        <th>S. No</th>
                                                        <th>Event Date</th>
                                                        <th>Job Card No</th>
                                                        <th>Action Taken</th>
                                                    
                                                    
                                                    </tr>
                                                </thead>
                                                <tbody>


                                                {% for prv_dts in prv_data2 %}
                                                        <tr>
                                                            <td>{{ prv_dts.st_gen }}</td>
                                                            <td>{{ prv_dts.date }}</td>
                                                            <td>{{ prv_dts.job_card_no }}</td>
                                                            <td>{{ prv_dts.immediate_investigation }}</td>
                                                        
                                                            
                                                        
                                                        </tr>
                                                    {% empty %}
                                                        <tr>
                                                            <td colspan="6" class="text-center text-muted">No job card available</td>
                                                        </tr>
                                                    {% endfor %}

                                                    





                                                </tbody>
                                            </table>
                                    </div>
                                </div>


                                <div class="row " style="padding: 20px;">


                                    <div class="col-lg-4">

                                        <span>Issued by (Name): <b>{{data.issued_by}}</b></span><br>
                                        <span>Designation / EMP ID: <b>{{data.issued_signature}}</b></span><br>
                                        <span>Date: <b>{{data.l1_date}}</b></span><br>
                                        <span>Time: <b>{{data.l1_time}}</b></span><br>

                                    </div>

                               

                                </div>


                                <hr>




                                {% if data.run_status == 3  %}

                                {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %}     


                                    <div class="row " style="padding: 20px;text-align: center;">
                                        <div class="col-lg-12 " >
                                            <h5>LEVEL 2  Acceptance of Job Card (To be filled by nominated work supervisor)</h5>
                                            
                                        </div>

                                    </div>



                                        <form id="Level2FinalForm">
                                        <div class="row " style="padding: 20px;">


                                             

                                        

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="received_by">*Received by (Name): </label>
                                                        <input type="text" class="form-control" id="received_by"  name="received_by" value="{{data.received_by}}" required="required" readonly>
                                                        <div class="invalid-feedback">
                                                        Please enter Received by (Name).
                                                        </div>
                                                    </div>
                                                </div>

                                                 <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="received_by_signature">*Designation / EMP ID: </label>
                                                        <input type="text" class="form-control" id="received_by_signature"  name="received_by_signature" value="{{data.received_by_signature}}" required="required" readonly>
                                                        <div class="invalid-feedback">
                                                        Please enter Designation / EMP ID.
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-4 hide d-none">
                                                    <div class="form-group">
                                                        <label for="signature_img">*Signature: </label>
                                                        <input type="file" class="form-control" id="signature_img2"  name="signature_img2" accept="image/*">
                                                        <div class="invalid-feedback">
                                                        Please upload Signature.
                                                        </div>
                                                    </div>
                                                </div>


                                                    
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="l2_date">*Date (DD/MM/YYYY):</label>
                                                        <input type="text" autocomplete="off" required="required" class="form-control date-time" id="l2_date" name="l2_date" value="{{data.l2_date|date:'d/m/Y'}}">
                                                        <div class="invalid-feedback">
                                                        Please enter Date.
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="l2_time">*Time:</label>
                                                        <input type="time" class="form-control" id="l2_time" required="required" name="l2_time" value="{{data.l2_time|date:"H:i"}}">
                                                        <div class="invalid-feedback">
                                                        Please enter Time.
                                                        </div>
                                                    </div>
                                                </div>

                                                   <div class="col-md-12">
                                                    <div class="form-group">
                                                        <label>
                                                            <input type="checkbox" name="agree_terms" required="required">
                                                            I hereby declare that, I accept the responsibility to carry out the work on the equipment detailed on this Job Card only, and no attempt shall be made by me or any person under my control, to carry out work on any other equipment. 
                                                            </label>
                                                    </div>
                                                </div>



                                                <div class="col-12">  
                                                    <button type="submit" class="btn btn-primary mt-2" >Update</button>

                                                </div>
                                                


                                        </div>

                                        </form>

                                {% endif %} 


                                {% else %}

                                 {% if data.run_status > 3 %}

                                        <div class="row " style="padding: 20px;">
                                            <div class="col-lg-12"><h3>LEVEL 2  Acceptance of Job Card (To be filled by nominated work supervisor)</h3></div>

                                            {% if request.session.user_Role == 1 or request.session.user_Role == 2 %}   

                                            <div class="col-lg-4">
                                                <input type="button" value="Edit LEVEL 2  Acceptance of Job Card" class="btn btn-primary" onClick="Level2FinalFormRelease()">
                                            </div>

                                            {% endif %}
                                            

                                        </div>


                                        <div class="row " style="padding: 20px;">

                                             <div class="col-lg-12">
                                        <span>

                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-check text-success" viewBox="0 0 16 16">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
                        </svg>
                                                                                
                                                                                
                                                                                <b>I hereby declare that, I accept the responsibility to carry out the work on the equipment detailed on this Job Card only, and no attempt shall be made by me or any person under my control, to carry out work on any other equipment. </b></span>
                                     </div>


                                            <div class="col-lg-4">

                                                <span>Received by (Name): <b>{{data.received_by}}</b></span><br>
                                                <span>Designation / EMP ID: <b>{{data.received_by_signature}}</b></span><br>
                                                <span>Date: <b>{{data.l2_date}}</b></span><br>
                                                <span>Time: <b>{{data.l2_time}}</b></span><br>

                                            </div>

                                            <!-- <div class="col-lg-4">
                                                <img src="/static/{{data.signature_img2}}" style="width: 60px;">

                                            </div> -->

                                        </div>



                                         {% if data.run_status == 4 %}

                                         {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %}     



                                               <div class="row " style="padding: 20px;text-align: center;">
                                                    <div class="col-lg-12 " >
                                                        <h5>LEVEL 2 Allotment of work to Maintainers</h5>
                                                        
                                                    </div>

                                                    
                                                        {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                                                            <div class="col-lg-12 " align="right">
                                                                <input type="button" value="Add new Work to Maintainers" class="btn btn-primary" onClick="createNewWork();">
                                                            </div>

                                                        {% endif %}
                                                

                                                </div>



                                                <div class="row " style="padding: 20px;text-align: center;">
                                                    <div class="col-md-12">
                                                        <table id="example" class="table stripe row-border order-column table-bordered" style="width:100%">
                                                            <thead>
                                                                <tr>
                                                                
                                                                    <th>S. No</th>
                                                                    <th>Name</th>
                                                                    <th>Work</th>
                                                                    <!-- <th>Signature</th> -->
                                                                   
                                                                    <th class="bg-white">
                                                                        
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>


                                                            {% for job_works in job_works %}
                                                                    <tr>
                                                                        <td>{{ job_works.s_no }}</td>
                                                                        <td>{{ job_works.jobwork_name }}</td>
                                                                        <td>{{ job_works.jobwork_work }}</td>
                                                                        <!-- <td>
 <img src="/static/uploads/{{ job_works.jobwork_signature }}" style="width: 60px;">
                                                                            
                                                                            
                                                                     </td> -->
                                                                       
                                                                        
                                                                        <td class="bg-white">

                                                                            {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                                                                <input type="button" value="Edit" onClick="editJobWork('{{ job_works.job_work_id }}',`{{ job_works.jobwork_name }}`,`{{ job_works.jobwork_work }}`);">

                                                                <input type="button" value="Delete" onClick="deleteJobWork('{{ job_works.job_work_id }}');">


                                                                            {% endif %}

                                                                        </td>
                                                                    </tr>
                                                                {% empty %}
                                                                    <tr>
                                                                        <td colspan="5" class="text-center text-muted">No work available</td>
                                                                    </tr>
                                                                {% endfor %}

                                                                





                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>



                                                  <form id="Level2WorkForm">
                                                    <div class="row " style="padding: 20px;">


                                                             <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <label for="details_of_the_activitues">Details of the activities carried out:</label>
                                                                    <textarea class="form-control" id="details_of_the_activitues" name="details_of_the_activitues">{{data.details_of_the_activitues}}</textarea>
                                                                    <div class="invalid-feedback">
                                                                    Please enter Details of the activities carried out.
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <label for="follow_up_details">Follow Up Details:</label>
                                                                    <textarea class="form-control" id="follow_up_details" name="follow_up_details">{{data.follow_up_details}}</textarea>
                                                                    <div class="invalid-feedback">
                                                                    Please enter Follow Up Details.
                                                                    </div>
                                                                </div>
                                                            </div>


                                                                <div class="col-md-4">
                                                                    <div class="form-group">
                                                                        <label for="handed_over">Job Card Handed over to the next supervisor, if work is not completed in your shift:</label>
                                                                        <select class="form-control" id="handed_over" name="handed_over" onchange="changeSupervisor();">
                                                                             {% if 'No' == data.handed_over %}
                                                                            <option value="No" selected>No</option>
                                                                            {% else %}
                                                                                <option value="No">No</option>
                                                                            {% endif %}
                                                                            {% if 'Yes' == data.handed_over %}
                                                                            <option value="Yes" selected>Yes</option>
                                                                            {% else %}
                                                                                <option value="Yes">Yes</option>
                                                                            {% endif %}
                                                                           
                                                                        </select>
                                                                        {% comment %} <input type="text" class="form-control" id="handed_over" name="handed_over" value="{{data.handed_over}}"> {% endcomment %}
                                                                        <div class="invalid-feedback">
                                                                        Please enter Job Card Handed over.
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div id="new_supervisor_no_div" class="col-8">

                                                                    <div class="row"> 


                                                                        <div class="col-6">
                                                                            <div class="form-group">
                                                                                <label for="new_supervisor">Name of the New Supervisor:</label>
                                                                                <input type="text" class="form-control" id="new_supervisor" name="new_supervisor" value="{{data.new_supervisor}}" readonly>
                                                                                <div class="invalid-feedback">
                                                                                Please enter Name of the New Supervisor.
                                                                                </div>
                                                                            </div>
                                                                        </div>


                                                                        <div class="col-6">
                                                                            <div class="form-group">
                                                                                <label for="new_supervisor_signature">Designation / EMP ID:</label>
                                                                                <input type="text" class="form-control" id="new_supervisor_signature" name="new_supervisor_signature" value="{{data.new_supervisor_signature}}" readonly>
                                                                                <div class="invalid-feedback">
                                                                                Please enter Designation / EMP ID.
                                                                                </div>
                                                                            </div>
                                                                        </div>


                                                                        <div class="col-md-4 hide d-none">
                                                                            <div class="form-group">
                                                                                <label for="signature_img3">Sign. of the New Supervisor: </label>
                                                                                <input type="file" class="form-control" id="signature_img3"  name="signature_img3" accept="image/*">
                                                                                <div class="invalid-feedback">
                                                                                Please upload Sign. of the New Supervisor.
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                    </div>

                                                                </div>
                                                                <div id="new_supervisor_yes_div" class="d-none col-8">


                                                                    <div class="row"> 



                                                                         <div class="col-md-12 ">
                                                                            <div class="form-group">
                                                                                <label for="software_version">Select New Supervisor and Designation / EMP ID:</label>
                                                                                <select class="form-control" id="new_supervisor_id" name="new_supervisor_id" >
                                                                                <option value="">--  Select New Supervisor and Designation / EMP ID  --</option>
                                                                                {% for sup in supervisorList %}
                                                                                    {% if sup.id == data.new_supervisor_id %}
                                                                                        <option value="{{sup.id}}" selected>{{sup.val}} </option>
                                                                                    {% else %}
                                                                                        <option value="{{sup.id}}">{{sup.val}} </option>
                                                                                    {% endif %}
                                                                                        
                                                                                {% endfor %}
                                                                                </select>


                                                                                <div class="invalid-feedback">
                                                                                Please enter New SupervisorDesignation / EMP ID.
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        


                                                                    </div>

                                                                </div>



                                                            <div class="col-12">  
                                                                <button type="submit" class="btn btn-primary mt-2" >Update</button>

                                                            </div>
                                                            


                                                    </div>

                                                    </form>

                                            {% endif %} 


                                        {% else %}


                                        {% if data.run_status > 4 %}

                                          <div class="row " style="padding: 20px;">
                                            <div class="col-lg-12"><h3>LEVEL 2 Allotment of work to Maintainers</h3></div>
                                            

                                        </div>


                                         <div class="row " style="padding: 20px;text-align: center;">
                                            <div class="col-md-12">
                                                <table id="example" class="table stripe row-border order-column table-bordered" style="width:100%">
                                                    <thead>
                                                        <tr>
                                                        
                                                            <th>S. No</th>
                                                            <th>Name</th>
                                                            <th>Work</th>
                                                            <!-- <th>Signature</th> -->
                                                    
                                                        </tr>
                                                    </thead>
                                                    <tbody>


                                                    {% for job_works in job_works %}
                                                            <tr>
                                                                <td>{{ job_works.s_no }}</td>
                                                                <td>{{ job_works.jobwork_name }}</td>
                                                                <td>{{ job_works.jobwork_work }}</td>
                                                                <!-- <td>{{ job_works.jobwork_signature }}</td> -->
                                                                
                                                            
                                                            </tr>
                                                        {% empty %}
                                                            <tr>
                                                                <td colspan="5" class="text-center text-muted">No work available</td>
                                                            </tr>
                                                        {% endfor %}


                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>


                                        <div class="row " style="padding: 20px;">


                                            <div class="col-lg-12">
                                                <span>Details of the activities carried out: <b>{{data.details_of_the_activitues}}</b></span><br>
                                                <span>Follow Up Details: <b>{{data.follow_up_details}}</b></span><br>
                                                <span>Job Card Handed over to the next supervisor, if work is not completed in your shift: <b>{{data.handed_over}}</b></span><br>
                                                <span>Name of the New Supervisor: <b>{{data.new_supervisor}}</b></span><br>
                                                <span>Designation / EMP ID:  <b>{{data.new_supervisor_signature}}</b></span><br>

                                            </div>

                                        <!-- {% if data.signature_img3 %}
                                            <div class="col-lg-4">
                                                <img src="/static/{{ data.signature_img3 }}" style="width: 60px;">
                                            </div>
                                        {% endif %} -->


                                        </div>



                                          {% if data.run_status < 6 %}

                                          {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %}   

                                            <div class="col-lg-4">
                                                <input type="button" value="Edit LEVEL 2 Allotment of work to Maintainers" class="btn btn-primary" onClick="editLevel2Work()">
                                            </div>

                                            {% endif %}

                                            {% endif %}



                                            {% if data.run_status == 5 %}

                                            {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %} 



                                                <div class="row " style="padding: 20px;text-align: center;">
                                                    <div class="col-lg-12 " >
                                                        <h5>LEVEL 2 Details of the Equipment Replaced</h5>
                                                        
                                                    </div>

                                                    {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                                                        <div class="col-lg-12 " align="right">
                                                            <input type="button" value="Add new Replaced Equipment" class="btn btn-primary" onClick="createNewEquipment();">
                                                        </div>

                                                    {% endif %}

                                                    

                                                </div>


                                                 <div class="row " style="padding: 20px;text-align: center;">
                                                    <div class="col-md-12">
                                                        <table id="example" class="table stripe row-border order-column table-bordered" style="width:100%">
                                                            <thead>
                                                                <tr>
                                                                
                                                                    <th>S. No</th>
                                                                    <th>Name of Equipment</th>
                                                                    <th>In Sr.No.(New)</th>
                                                                    <th>Out Sr.No.(Old)</th>
                                                                   
                                                                    <th class="bg-white">
                                                                        
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>


                                                            {% for job_equipment in job_equipment %}
                                                                    <tr>
                                                                        <td>{{ job_equipment.s_no }}</td>
                                                                        <td>{{ job_equipment.jobequipment_name }}</td>
                                                                        <td>{{ job_equipment.jobequipment_new_no }}</td>
                                                                        <td>{{ job_equipment.jobequipment_old_no }}</td>
                                                                       
                                                                        
                                                                        <td class="bg-white">

                                                                            {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %}

                                                                <input type="button" value="Edit" onClick="editJobEquipment('{{ job_equipment.job_equipment_id }}',`{{ job_equipment.jobequipment_name }}`,`{{ job_equipment.jobequipment_new_no }}`,`{{ job_equipment.jobequipment_old_no }}`);">

                                                                <input type="button" value="Delete" onClick="deleteJobEquipment('{{ job_equipment.job_equipment_id }}');">


                                                                            {% endif %}

                                                                        </td>
                                                                    </tr>
                                                                {% empty %}
                                                                    <tr>
                                                                        <td colspan="6" class="text-center text-muted">No Equipment Replaced</td>
                                                                    </tr>
                                                                {% endfor %}

                                                                





                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>


                                                <div class="row " style="padding: 20px;text-align: center;">
                                                    <div class="col-lg-12 " >
                                                        <h5>LEVEL 2 Job Completion Report</h5>
                                                        
                                                    </div>

                                               

                                                </div>


                                                 <form id="Level2EquipmentForm">
                                                    <div class="row " style="padding: 20px;">

                                                             <div class="col-md-12">
                                                                <div class="form-group">
                                                                    <label>
                                                                        <input type="checkbox" name="agree_terms2" required="required">
                                                                        I hereby declare that; all persons have been withdrawn and all the equipment affected as detailed in Part A above have been restored to normal.
                                                                        </label>
                                                                </div>
                                                            </div>

                                                              <div class="col-md-4">
                                                                <div class="form-group">
                                                                    <label for="train_can_be_energized">*Train can be energized:</label>
                                                                    <select class="form-control" id="train_can_be_energized" name="train_can_be_energized" required="required">
                                                                        {% if 'Yes' == data.train_can_be_energized %}
                                                                        <option value="Yes" selected>Yes</option>
                                                                        {% else %}
                                                                            <option value="Yes">Yes</option>
                                                                        {% endif %}
                                                                        {% if 'No' == data.train_can_be_energized %}
                                                                        <option value="No" selected>No</option>
                                                                        {% else %}
                                                                            <option value="No">No</option>
                                                                        {% endif %}
                                                                    </select>
                                                                    {% comment %} <input type="text" class="form-control" id="train_can_be_energized" name="train_can_be_energized" value="{{data.train_can_be_energized}}"> {% endcomment %}
                                                                    <div class="invalid-feedback">
                                                                    Please enter Train can be energized.
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <div class="col-md-4">
                                                                <div class="form-group">
                                                                    <label for="completion_name">*Name:</label>
                                                                    <input type="text" class="form-control" id="completion_name" name="completion_name" value="{{data.completion_name}}" required="required" readonly>
                                                                    <div class="invalid-feedback">
                                                                    Please enter Name.
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        

                                                              <div class="col-md-4">
                                                                <div class="form-group">
                                                                    <label for="train_can_be_moved">*Train can be moved:</label>
                                                                    <select class="form-control" id="train_can_be_moved" name="train_can_be_moved" required="required">
                                                                        {% if 'Yes' == data.train_can_be_moved %}
                                                                        <option value="Yes" selected>Yes</option>
                                                                        {% else %}
                                                                            <option value="Yes">Yes</option>
                                                                        {% endif %}
                                                                        {% if 'No' == data.train_can_be_moved %}
                                                                        <option value="No" selected>No</option>
                                                                        {% else %}
                                                                            <option value="No">No</option>
                                                                        {% endif %}
                                                                    </select>
                                                                    {% comment %} <input type="text" class="form-control" id="train_can_be_moved" name="train_can_be_moved" value="{{data.train_can_be_moved}}"> {% endcomment %}
                                                                    <div class="invalid-feedback">
                                                                    Please enter Train can be moved.
                                                                    </div>
                                                                </div>
                                                            </div>


                                                              <div class="col-md-4">
                                                                <div class="form-group">
                                                                    <label for="completion_date">*Date (DD/MM/YYYY):</label>
                                                                    <input type="text" autocomplete="off" required="required" class="form-control date-time" id="completion_date" name="completion_date" value="{{data.completion_date|date:'d/m/Y'}}" onchange="getServiceDelay();">
                                                                    <div class="invalid-feedback">
                                                                    Please enter Date.
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-4">
                                                                <div class="form-group">
                                                                    <label for="completion_date_time">*Time:</label>
                                                                    <input type="time" class="form-control" id="completion_date_time" required="required" name="completion_date_time" value="{{data.completion_date_time|date:"H:i"}}" onchange="getServiceDelay();">
                                                                    <div class="invalid-feedback">
                                                                    Please enter Time.
                                                                    </div>
                                                                </div>
                                                            </div>


                                                                <div class="col-md-4">
                                                                <div class="form-group">
                                                                    <label for="down_time">Down Time (mins):</label>
                                                                    <input type="number" class="form-control" id="down_time" name="down_time" value="{{data.down_time}}">
                                                                    <div class="invalid-feedback">
                                                                    Please enter Down Time.
                                                                    </div>
                                                                </div>
                                                            </div>


                                                                <div class="col-md-4 hide d-none">
                                                                    <div class="form-group">
                                                                        <label for="signature_img4">*Signature: </label>
                                                                        <input type="file" class="form-control" id="signature_img4"  name="signature_img4" accept="image/*">
                                                                        <div class="invalid-feedback">
                                                                        Please upload Signature.
                                                                        </div>
                                                                    </div>
                                                                </div>


                                                            <div class="col-md-4">
                                                                <div class="form-group">
                                                                    <label for="completion_signature">Designation / EMP ID:</label>
                                                                    <input type="text" class="form-control" id="completion_signature" name="completion_signature" value="{{data.completion_signature}}" required="required" readonly>
                                                                    <div class="invalid-feedback">
                                                                    Please enter Designation / EMP ID.
                                                                    </div>
                                                                </div>
                                                            </div>





                                                            <div class="col-12">  
                                                                <button type="submit" class="btn btn-primary mt-2" >Update</button>

                                                            </div>
                                                            


                                                    </div>

                                                </form>


                                                {% endif %}

                                            {% else %}

                                                {% if data.run_status > 5 %}



                                                    <div class="row " style="padding: 20px;">
                                                        <div class="col-lg-12"><h3>LEVEL 2 Details of the Equipment Replaced</h3></div>
                                                        

                                                        </div>


                                                        <div class="row " style="padding: 20px;text-align: center;">
                                                                                <div class="col-md-12">
                                                                                    <table id="example" class="table stripe row-border order-column table-bordered" style="width:100%">
                                                                                        <thead>
                                                                                            <tr>
                                                                                            
                                                                                                <th>S. No</th>
                                                                                                <th>Name of Equipment</th>
                                                                                                <th>In Sr.No.(New)</th>
                                                                                                <th>Out Sr.No.(Old)</th>
                                                                                            
                                                                                            </tr>
                                                                                        </thead>
                                                                                        <tbody>


                                                                                        {% for job_equipment in job_equipment %}
                                                                                                <tr>
                                                                                                    <td>{{ job_equipment.s_no }}</td>
                                                                                                    <td>{{ job_equipment.jobequipment_name }}</td>
                                                                                                    <td>{{ job_equipment.jobequipment_new_no }}</td>
                                                                                                    <td>{{ job_equipment.jobequipment_old_no }}</td>
                                                                                                
                                                                                                
                                                                                                </tr>
                                                                                            {% empty %}
                                                                                                <tr>
                                                                                                    <td colspan="6" class="text-center text-muted">No Equipment Replaced</td>
                                                                                                </tr>
                                                                                            {% endfor %}

                                                                                            





                                                                                        </tbody>
                                                                                    </table>
                                                                                </div>
                                                                            </div>



                                                        {% if data.run_status < 6 %}

                                                        {% if request.session.user_Role == 6 or request.session.user_Role == 1 or request.session.user_Role == 2 %}   

                                                        <div class="col-lg-4">
                                                            <input type="button" value="Edit LEVEL 2 Details of the Equipment Replaced" class="btn btn-primary" onClick="editLevel2Equipment()">
                                                        </div>

                                                        {% endif %}

                                                        {% endif %}


                                                        <div class="row " style="padding: 20px;">
                                                        <div class="col-lg-12"><h3>LEVEL 2 Job Completion Report</h3>


                                                            {% if request.session.user_Role == 1 or request.session.user_Role == 2 %}   

                                                            <div class="col-lg-12">

                                                                <input class="btn btn-primary mt-2" type="button" value="Edit LEVEL 2 Job Completion Report" class="btn btn-primary" onClick="editLevel2Completion()">

                                                            </div>

                                                            
    
                                                            {% endif %}
                                                            
                                                        
                                                        
                                                        
                                                        
                                                        </div>
                                                        

                                                        </div>


                                                            <div class="row " style="padding: 20px;">

                                                                  <div class="col-lg-12">
                                        <span>

                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-check text-success" viewBox="0 0 16 16">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
                        </svg>
                                                                                
                                                                                
                                                                                <b>I hereby declare that; all persons have been withdrawn and all the equipment affected as detailed in Part A above have been restored to normal.</b></span>
                                     </div>


                                                                    <div class="col-lg-4">

                                                                        <span>Train can be energized: <b>{{data.train_can_be_energized}}</b></span><br>
                                                                        <span>Name: <b>{{data.completion_name}}</b></span><br>

                                                                        {% if data.down_time %}
                                                                        <span>Down Time: <b>{{ data.down_time }} mins</b></span>
                                                                        {% else %}
                                                                        <span>Down Time: <b>{{data.down_time}} </b></span>
                                                                        {% endif %}
                                                                        <br>
                                                                    
                                                                    </div>


                                                                    <div class="col-lg-4">

                                                                
                                                                        <span>Train can be moved: <b>{{data.train_can_be_moved}}</b></span><br>
                                                                        <span>Date : <b>{{data.completion_date}}</b></span><br>
                                                                        <span>Time: <b>{{data.completion_date_time}}</b></span><br>

                                                                    </div>

                                                                    <div class="col-lg-12">
                                                                        <span>Designation / EMP ID: <b>{{data.completion_signature}}</b></span><br>
                                                                    </div>

                                                                <!-- {% if data.signature_img4 %}
                                                                    <div class="col-lg-4">
                                                                        <img src="/static/{{ data.signature_img4 }}" style="width: 60px;">
                                                                    </div>
                                                                {% endif %} -->


                                                            </div>



                                                    {% if data.run_status == 6  %}

                                                    {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}   



                                                            <div class="row " style="padding: 20px;text-align: center;">
                                                                <div class="col-lg-12 " >
                                                                    <h5>LEVEL 3 SIC Completion Report</h5>
                                                                    
                                                                </div>

                                                                

                                                        

                                                            </div>


                                                             <form id="Level2CompletionForm">
                                                                    <div class="row " style="padding: 20px;">


                                                                            <div class="col-md-8">
                                                                                <div class="form-group">
                                                                                    <label for="corrective_action">Corrective action required to be carried out (if any):</label>
                                                                                    <textarea class="form-control" id="corrective_action" name="corrective_action">{{data.corrective_action}}</textarea>
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Corrective action required to be carried out (if any).
                                                                                    </div>
                                                                                </div>
                                                                            </div>


                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="sic_start_date">*SIC Start Date (DD/MM/YYYY):</label>
                                                                                    <input type="text" autocomplete="off" required="required" class="form-control date-time" id="sic_start_date" name="sic_start_date" value="{{data.sic_start_date|date:'d/m/Y'}}" onchange="getDounTime();">
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Date.
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="sic_start_time">*SIC Start Time(HH:MM):</label>
                                                                                    <input type="time" class="form-control" id="sic_start_time" name="sic_start_time" value="{{data.sic_start_time}}" required="required" onchange="getDounTime();">
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter SIC Start Time.
                                                                                    </div>
                                                                                </div>
                                                                            </div>



                                                                            <div class="col-md-12">
                                                                                <div class="form-group">

                                                                                    <label>I hereby declare that, </label><br>

                                                                                    <label>
                                                                                        <input type="checkbox" name="sic_has_performed" name="sic_has_performed" required >
                                                                                        SIC has been performed on concerned equipment.
                                                                                        </label><br>

                                                                                         <label>
                                                                                        <input type="checkbox" name="agree_terms4" name="agree_terms3" required="required">
                                                                                        All the necessary follow up action as described in Part F above and final inspection, including SIC (if any), have been completed. 
                                                                                        </label>


                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="train_can_be_energized2">*Train can be energized:</label>
                                                                                    <select class="form-control" id="train_can_be_energized2" name="train_can_be_energized2" required="required">
                                                                                        {% if 'Yes' == data.train_can_be_energized2 %}
                                                                                        <option value="Yes" selected>Yes</option>
                                                                                        {% else %}
                                                                                            <option value="Yes">Yes</option>
                                                                                        {% endif %}
                                                                                        {% if 'No' == data.train_can_be_energized2 %}
                                                                                        <option value="No" selected>No</option>
                                                                                        {% else %}
                                                                                            <option value="No">No</option>
                                                                                        {% endif %}
                                                                                    </select>
                                                                                    {% comment %} <input type="text" class="form-control" id="train_can_be_energized2" name="train_can_be_energized2" value="{{data.train_can_be_energized2}}"> {% endcomment %}
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Train can be energized.
                                                                                    </div>
                                                                                </div>
                                                                            </div>


                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="completion_name2">*Name:</label>
                                                                                    <input type="text" class="form-control" id="completion_name2" name="completion_name2" value="{{data.completion_name2}}" required="required" readonly>
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Name.
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                         

                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="train_can_be_moved2">*Train can be moved:</label>
                                                                                    <select class="form-control" id="train_can_be_moved2" name="train_can_be_moved2" required="required">
                                                                                        {% if 'Yes' == data.train_can_be_moved2 %}
                                                                                        <option value="Yes" selected>Yes</option>
                                                                                        {% else %}
                                                                                            <option value="Yes">Yes</option>
                                                                                        {% endif %}
                                                                                        {% if 'No' == data.train_can_be_moved2 %}
                                                                                        <option value="No" selected>No</option>
                                                                                        {% else %}
                                                                                            <option value="No">No</option>
                                                                                        {% endif %}
                                                                                    </select>
                                                                                    {% comment %} <input type="text" class="form-control" id="train_can_be_moved2" name="train_can_be_moved2" value="{{data.train_can_be_moved2}}"> {% endcomment %}
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Train can be moved.
                                                                                    </div>
                                                                                </div>
                                                                            </div>


                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="completion_date2">*Date (DD/MM/YYYY):</label>
                                                                                    <input type="text" autocomplete="off" required="required" class="form-control date-time" id="completion_date2" name="completion_date2" value="{{data.completion_date2|date:'d/m/Y'}}" onchange="getDounTime();">
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Date.
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="completion_date_time2">*Time:</label>
                                                                                    <input type="time" class="form-control" id="completion_date_time2" required="required" name="completion_date_time2" value="{{data.completion_date_time2|date:"H:i"}}" onchange="getDounTime();">
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Time.
                                                                                    </div>
                                                                                </div>
                                                                            </div>


                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="down_time2">Down Time(mins):</label>
                                                                                    <input type="number" class="form-control" id="down_time2" name="down_time2" value="{{data.down_time2}}">
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Down Time.
                                                                                    </div>
                                                                                </div>
                                                                            </div>


                                                                                <div class="col-md-4 hide d-none">
                                                                                    <div class="form-group">
                                                                                        <label for="signature_img5">*Signature: </label>
                                                                                        <input type="file" class="form-control" id="signature_img5"  name="signature_img5" accept="image/*">
                                                                                        <div class="invalid-feedback">
                                                                                        Please upload Signature.
                                                                                        </div>
                                                                                    </div>
                                                                                </div>



                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="completion_signature2">*Designation / EMP ID:</label>
                                                                                    <input type="text" class="form-control" id="completion_signature2" name="completion_signature2" value="{{data.completion_signature2}}" required="required" readonly>
                                                                                    <div class="invalid-feedback">
                                                                                    Please enter Designation / EMP ID.
                                                                                    </div>
                                                                                </div>
                                                                            </div>






                                                                            <div class="col-12">  
                                                                                <button type="submit" class="btn btn-primary mt-2" >Update</button>

                                                                            </div>
                                                                            


                                                                    </div>

                                                                </form>





                                                                {% endif %}

                                                    {% else %}

                                                        {% if data.run_status > 6 %}


                                                                <div class="row " style="padding: 20px;">
                                                                    <div class="col-lg-12"><h3>LEVEL 3 SIC Completion Report</h3></div>


                                                                    {% if request.session.user_Role == 1 or request.session.user_Role == 2 %}   

                                                                    <div class="col-lg-12">
                                                                        <input  type="button" value="Edit LEVEL 3 SIC Completion Report" class="btn btn-primary" onClick="editLevel2Close()">
                                                                    </div>

                                                                   
            
                                                                    {% endif %}



                                                                  

                                                                </div>


                                                                <div class="row " style="padding: 20px;">

                                                                        <div class="col-lg-12">

                                                                            <span>Corrective action required to be carried out (if any): <b>{{data.corrective_action}}</b></span><br>
                                                                            <span>SIC Start Date: <b>{{data.sic_start_date}}</b></span><br>
                                                                            <span>SIC Start Time: <b>{{data.sic_start_time}}</b></span><br>

                                                                            {% if data.sic_has_performed == 1 or data.sic_has_performed == '1' %}

                                                                            <span>

                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-check text-success" viewBox="0 0 16 16">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
                        </svg>
                                                                                
                                                                                
                                                                                <b>SIC has been performed on concerned equipment.</b></span>

                                                                            {% else %}

                                                                            <span>


                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-x text-danger" viewBox="0 0 16 16">
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                        </svg>
                                                                                
                                                                                
                                                                                <b>SIC has been performed on concerned equipment.</b></span>

                                                                            {% endif %}

                        <br>
                                                                            <span>

                                                                                <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" class="bi bi-check text-success" viewBox="0 0 16 16">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
                        </svg>
                                                                                
                                                                                
                                                                                <b>All the necessary follow up action as described in Part F above and final inspection, including SIC (if any), have been completed. </b></span>



                                                                            
                                                                        </div>


                                                                        <div class="col-lg-4">

                                                                            <span>Train can be energized: <b>{{data.train_can_be_energized2}}</b></span><br>
                                                                            <span>Name: <b>{{data.completion_name2}}</b></span><br>

                                                                            {% if data.down_time2 %}
                                                                            <span>Down Time: <b>{{ data.down_time2 }} mins</b></span>
                                                                            {% else %}
                                                                            <span>Down Time: <b>{{data.down_time2}} </b></span>
                                                                            {% endif %}

                                                                            <br>
                                                                        
                                                                        </div>


                                                                        <div class="col-lg-4">

                                                                    
                                                                            <span>Train can be moved: <b>{{data.train_can_be_moved2}}</b></span><br>
                                                                            <span>Date : <b>{{data.completion_date2}}</b></span><br>
                                                                            <span>Time: <b>{{data.completion_date_time2}}</b></span><br>

                                                                        </div>

                                                                        <div class="col-lg-4">
                                                                            <span>Designation / EMP ID: <b>{{data.completion_signature2}}</b></span><br>
                                                                        </div>

                                                                    <!-- {% if data.signature_img5 %}
                                                                        <div class="col-lg-4">
                                                                            <img src="/static/{{ data.signature_img5 }}" style="width: 60px;">
                                                                        </div>
                                                                    {% endif %} -->


                                                                </div>


                                                                {% if data.run_status == 7  %}

                                                                {% if request.session.user_Role == 5 or request.session.user_Role == 1 or request.session.user_Role == 2 %}


                                                                    <div class="row " style="padding: 20px;text-align: center;">
                                                                        <div class="col-lg-12 " >
                                                                            <h5>LEVEL 3 Acknowledgement of returned Job Card (To be filled by PPIO)</h5>
                                                                            
                                                                        </div>

                                                                

                                                                    </div>


                                                                      <form id="Level3CompletionForm">
                                                                    <div class="row " style="padding: 20px;">


                                                                            <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="close_name">*Name :</label>
                                                                                    <input type="text" class="form-control" id="close_name" name="close_name" value="{{data.close_name }}" required="required" readonly>
                                                                                    <div class="invalid-feedback">
                                                                                        Please enter Name .
                                                                                    </div>
                                                                                </div>
                                                                            </div>




                                                                                    <div class="col-md-4">
                                                                            <div class="form-group">
                                                                                <label for="close_date">*Date (DD/MM/YYYY):</label>
                                                                                <input type="text" autocomplete="off" required="required" class="form-control date-time" id="close_date" name="close_date" value="{{data.close_date|date:'d/m/Y'}}">
                                                                                <div class="invalid-feedback">
                                                                                Please enter Date.
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                        <div class="col-md-4">
                                                                            <div class="form-group">
                                                                                <label for="close_time">*Time:</label>
                                                                                <input type="time" class="form-control" id="close_time" required="required" name="close_time" value="{{data.close_time|date:"H:i"}}">
                                                                                <div class="invalid-feedback">
                                                                                Please enter Time.
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                            <div class="col-md-4 hide d-none">
                                                                                <div class="form-group">
                                                                                    <label for="signature_img6">*Signature: </label>
                                                                                    <input type="file" class="form-control" id="signature_img6"  name="signature_img6" accept="image/*">
                                                                                    <div class="invalid-feedback">
                                                                                    Please upload Signature.
                                                                                    </div>
                                                                                </div>
                                                                            </div>


                                                                              <div class="col-md-4">
                                                                                <div class="form-group">
                                                                                    <label for="close_name_signature">*Designation / EMP ID :</label>
                                                                                    <input type="text" class="form-control" id="close_name_signature" name="close_name_signature" value="{{data.close_name_signature }}" required="required" readonly>
                                                                                    <div class="invalid-feedback">
                                                                                        Please enter Designation / EMP ID .
                                                                                    </div>
                                                                                </div>
                                                                            </div>





                                                                            <div class="col-12">  
                                                                                <button type="submit" class="btn btn-primary mt-2" >Close Job Card</button>


                                                                              


                                                                            </div>
                                                                            


                                                                    </div>

                                                                </form>

                                                                {% endif %}

                                                                {% else %}

                                                                    {% if data.run_status > 7 %}




                                                                         <div class="row " style="padding: 20px;">
                                                                            <div class="col-lg-12"><h3>LEVEL 3 Acknowledgement of returned Job Card (To be filled by PPIO)</h3></div>





                                                                            

                                                                            </div>


                                                                            <div class="row " style="padding: 20px;">


                                                                                <div class="col-lg-4">
                                                                                    <span>Name: <b>{{data.close_name}}</b></span><br>
                                                                                    <span>Date: <b>{{data.close_date}}</b></span><br>
                                                                                    <span>Time: <b>{{data.close_time}}</b></span><br>
                                                                                    <span>Designation / EMP ID: <b>{{data.close_name_signature}}</b></span><br>

                                                                                </div>

                                                                            <!-- {% if data.signature_img6 %}
                                                                                <div class="col-lg-4">
                                                                                    <img src="/static/{{ data.signature_img6 }}" style="width: 60px;">
                                                                                </div>
                                                                            {% endif %} -->

                                                                            
                                                                            {% if request.session.user_Role == 1 or request.session.user_Role == 2 %}   

                                                                            <div class="col-lg-4">
                                                                                <input type="button" value="Edit Closed Job Card" class="btn btn-primary" onClick="editLevel3CloseCard()">
                                                                            </div>
                    
                                                                            {% endif %}


                                                                            </div>


                                                                        



                                                                        {% endif %}

                                                                {% endif %}



                                                        {% endif %}


                                                    {% endif %}
                                                        






                                                    
                                                {% endif %}

                                            {% endif %}


                                        {% endif %}



                                        {% endif %}

                                        {% endif %}


                                {% endif %}


                            {% endif %}

                        {% endif %}

                        


                        {% endif %}


                    {% endif %}


                {% endif %}




            {% endif %}


<!-- Modal HTML -->
<!-- Large Modal -->
<div class="modal fade" id="myModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg"> <!-- modal-lg makes it large -->
    <div class="modal-content">

         <form id="JobDetailsForm"> 
    
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">Job Details</h5>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">

        <div class="row mb-4">

            <div class="col-sm-6 d-none">
                <div class="form-group">
                    <label for="s_no">*S. No:</label>
                    <input type="text" class="form-control" id="s_no" name="s_no" value="1">
                    <div class="invalid-feedback">
                        Please enter S. No.
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label for="car_no">*Car No:</label>
                    <input type="text" class="form-control" required="required" id="car_no" name="car_no" value="{{data.sel_car}}" readonly>
                    <div class="invalid-feedback">
                        Please enter Car No.
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label for="sub_sym">*Sub System:</label>
                    <input type="text" class="form-control" required="required" id="sub_sym" name="sub_sym" value="{{data.subsystem}}" readonly>
                    <div class="invalid-feedback">
                        Please enter Sub System.
                    </div>
                </div>
            </div>

             <div class="col-sm-6">
                <div class="form-group">
                    <label for="inp_equipment">*Equipment:</label>
                    <input type="text" class="form-control" required="required" id="inp_equipment" name="inp_equipment" value="{{data.equipment}}" readonly>
                    <div class="invalid-feedback">
                        Please enter Equipment.
                    </div>
                </div>
            </div>

             <div class="col-sm-12">
                    <div class="form-group">
                        <label for="job_description">*Job Details:</label>
                        <textarea class="form-control" required="required" id="job_description" name="job_description"></textarea>
                         <div class="invalid-feedback">
                         Please enter Job Details.
                        </div>
                    </div>
                </div>





        </div>


        
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal();">Close</button>
        <button type="submit" class="btn btn-primary">Save</button>
        <input type="hidden" value="" id="JobDetailsID" name="JobDetailsID">
      </div>

      </form>

    </div>
  </div>
</div>

 <div class="modal fade" id="myModal2" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg"> <!-- modal-lg makes it large -->
    <div class="modal-content">

         <form id="JobWorkForm"> 
    
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">Allotment of work to Maintainers</h5>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">

        <div class="row mb-4">

            <div class="col-sm-6 ">
                <div class="form-group">
                    <label for="jobwork_name">*Name:</label>
                    <input type="text" class="form-control" id="jobwork_name" name="jobwork_name" value="" required="required">
                    <div class="invalid-feedback">
                        Please enter Name.
                    </div>
                </div>
            </div>

        

             <div class="col-sm-12">
                    <div class="form-group">
                        <label for="jobwork_work">*Work:</label>
                        <textarea class="form-control" required="required" id="jobwork_work" name="jobwork_work"></textarea>
                         <div class="invalid-feedback">
                         Please enter Work.
                        </div>
                    </div>
                </div>

                <div class="col-sm-12 hide d-none">

                     <div class="form-group">
                    <label for="jobwork_signature">*Signature: </label>
                    <input type="file" class="form-control" id="jobwork_signature"  name="jobwork_signature"  accept="image/*" >
                    <div class="invalid-feedback">
                    Please upload Signature.
                    </div>
                </div>

                </div>


                




        </div>


        
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal2();">Close</button>
        <button type="submit" class="btn btn-primary">Save</button>
        <input type="hidden" value="" id="JobWorkID" name="JobWorkID">
      </div>

      </form>

    </div>
  </div>
</div>  

<div class="modal fade" id="myModal3" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg"> <!-- modal-lg makes it large -->
    <div class="modal-content">

         <form id="JobEquipmentForm"> 
    
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">Details of the Equipment Replaced</h5>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">

        <div class="row mb-4">

            <div class="col-sm-6 ">
                <div class="form-group">
                    <label for="jobequipment_name">*Name of Equipment:</label>
                    <input type="text" class="form-control" id="jobequipment_name" name="jobequipment_name" value="" required="required">
                    <div class="invalid-feedback">
                        Please enter Name of Equipment.
                    </div>
                </div>
            </div>



             <div class="col-sm-6 ">
                <div class="form-group">
                    <label for="jobequipment_new_no">*In Sr.No.(New):</label>
                    <input type="text" class="form-control" id="jobequipment_new_no" name="jobequipment_new_no" value="" required="required">
                    <div class="invalid-feedback">
                        Please enter In Sr.No.(New).
                    </div>
                </div>
            </div>

              <div class="col-sm-6 ">
                <div class="form-group">
                    <label for="jobequipment_old_no">*Out Sr.No.(Old):</label>
                    <input type="text" class="form-control" id="jobequipment_old_no" name="jobequipment_old_no" value="" required="required">
                    <div class="invalid-feedback">
                        Please enter Out Sr.No.(Old).
                    </div>
                </div>
            </div>





        </div>


        
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal3();">Close</button>
        <button type="submit" class="btn btn-primary">Save</button>
        <input type="hidden" value="" id="JobEquipmentID" name="JobEquipmentID">
      </div>

      </form>

    </div>
  </div>
</div>  
            
{% endblock sb_admin_content %}
{% block sb_admin_js %}
<script>

     var myModal = new bootstrap.Modal(document.getElementById('myModal'));
      var myModal2 = new bootstrap.Modal(document.getElementById('myModal2'));
      var myModal3 = new bootstrap.Modal(document.getElementById('myModal3'));

    $(document).ready(function() {

          $('#event_date').datepicker({
          autoclose: true,
          format: 'dd/mm/yyyy',});

           $('#l1_date').datepicker({
          autoclose: true,
          format: 'dd/mm/yyyy',});

           $('#l2_date').datepicker({
          autoclose: true,
          format: 'dd/mm/yyyy',});

           $('#completion_date').datepicker({
          autoclose: true,
          format: 'dd/mm/yyyy',});

          $('#completion_date2').datepicker({
          autoclose: true,
          format: 'dd/mm/yyyy',});

           $('#close_date').datepicker({
          autoclose: true,
          format: 'dd/mm/yyyy',});


           $('#sic_start_date').datepicker({
          autoclose: true,
          format: 'dd/mm/yyyy',});

          var handed_over = '{{data.handed_over}}';
            if(handed_over == 'Yes'){
                $('#new_supervisor_no_div').addClass('d-none');
                $('#new_supervisor_yes_div').removeClass('d-none');
            }else{
                $('#new_supervisor_yes_div').addClass('d-none');
                $('#new_supervisor_no_div').removeClass('d-none');
            }

        // showRevenueService();
    });

    function changeSupervisor(){
        var handed_over = $('#handed_over').val();
        if(handed_over == 'Yes'){
            $('#new_supervisor_no_div').addClass('d-none');
            $('#new_supervisor_yes_div').removeClass('d-none');
        }else{
            $('#new_supervisor_yes_div').addClass('d-none');
            $('#new_supervisor_no_div').removeClass('d-none');
        }
    }

    $( "#JobDetailsForm" ).submit(function(e) {
        e.preventDefault();

        var job_description= $('#job_description').val()
        var s_no= $('#s_no').val()
        var JobDetailsID= $('#JobDetailsID').val()

        job_description = job_description.replace(/['"`]/g, '');

        var id= '{{data.id}}';

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            dataType: 'json',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            data : {
                'id':id,
                'job_description' : job_description,
                's_no':s_no,
                'JobDetailsID':JobDetailsID,
                'st':15,
            },

            success: function (response) {
                if(response.status == '1') {
                    window.location.reload(); 
                }
                else{
                    swal('Failed to save Job Details')
                    
                }
            }
        });
        


    });

    function getDounTime(){

    
        $('#down_time2').val('');

    var cm_start_date= $('#sic_start_date').val()
    var cm_start_time= $('#sic_start_time').val()
    var cm_end_date= $('#completion_date2').val()
    var cm_end_time= $('#completion_date_time2').val()


    if(cm_start_date != "" && cm_start_time != "" && cm_end_date != "" && cm_end_time != "" ){
        const input = cm_start_date+" "+cm_start_time;
        const input2 = cm_end_date+" "+cm_end_time;

        const diffInMinutes = getTimeDifferenceInMinutes(input2,input);
        $('#down_time2').val(diffInMinutes);
        // console.log(`Time difference: ${diffInMinutes} minute(s)`);

    }


    }



function getServiceDelay(){
    $('#down_time').val('');

    var cm_start_date= changeFormateForDate('{{data.l2_date}}');
    var cm_start_time= changeTimeFormate('{{data.l2_time}}')
    var cm_end_date= $('#completion_date').val()
    var cm_end_time= $('#completion_date_time').val()


    if(cm_start_date != "" && cm_start_time != "" && cm_end_date != "" && cm_end_time != "" ){
        const input = cm_start_date+" "+cm_start_time;
        const input2 = cm_end_date+" "+cm_end_time;

        const diffInMinutes = getTimeDifferenceInMinutes(input2,input);
        $('#down_time').val(diffInMinutes);
        // console.log(`Time difference: ${diffInMinutes} minute(s)`);

    }


}

function changeTimeFormate(time12h) {
    if (!time12h) return "";

    // Step 1: Normalize input
    const cleaned = time12h.toLowerCase().replace(/\./g, '').trim(); // remove periods and trim
    const parts = cleaned.split(' '); // Split time and am/pm

    if (parts.length !== 2) return ""; // invalid format

    const time = parts[0];      // "01:28"
    const modifier = parts[1];  // "am" or "pm"

    const timeParts = time.split(':');
    if (timeParts.length !== 2) return ""; // invalid time format

    let hours = parseInt(timeParts[0], 10);
    let minutes = parseInt(timeParts[1], 10);

    if (isNaN(hours) || isNaN(minutes)) return ""; // invalid numbers

    if (modifier === 'pm' && hours !== 12) {
        hours += 12;
    } else if (modifier === 'am' && hours === 12) {
        hours = 0;
    }

    const hh = String(hours).padStart(2, '0');
    const mm = String(minutes).padStart(2, '0');

    return `${hh}:${mm}`;
}


function changeFormateForDate(inputDate){

// Remove the period after the month abbreviation
const cleanedDate = inputDate.replace('.', '');

// Parse the date
const date = new Date(cleanedDate);

// Format to dd/mm/yyyy
const day = String(date.getDate()).padStart(2, '0');
const month = String(date.getMonth() + 1).padStart(2, '0'); // getMonth is zero-based
const year = date.getFullYear();

const formattedDate = `${day}/${month}/${year}`;
return formattedDate
}




function getTimeDifferenceInMinutes(inputDateTimeStr, inputDateTimeStr2 ) {
    // Parse input date string in "dd/mm/yyyy hh:mm" format
    const [datePart, timePart] = inputDateTimeStr.split(' ');
    const [day, month, year] = datePart.split('/').map(Number);
    const [hours, minutes] = timePart.split(':').map(Number);

    // Create a Date object from input
    const inputDate = new Date(year, month - 1, day, hours, minutes);


    const [datePart2, timePart2] = inputDateTimeStr2.split(' ');
    const [day2, month2, year2] = datePart2.split('/').map(Number);
    const [hours2, minutes2] = timePart2.split(':').map(Number);

    // Create a Date object from input
    const currentDate = new Date(year2, month2 - 1, day2, hours2, minutes2);

    // Get current time
    // const currentDate = new Date();

    // Calculate difference in milliseconds
    const diffMs = inputDate - currentDate;

    // Convert to minutes (rounded down)
    const diffMins = Math.floor(diffMs / 1000 / 60);

    return diffMins;
}


    
     $( "#JobWorkForm" ).submit(function(e) {
        e.preventDefault();

        var form = $('#JobWorkForm')[0];  // Get the raw DOM form element
        var formData = new FormData(form);    // Create FormData object

        formData.append('id', '{{ data.id }}');
        formData.append('st', 18);


        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            data: formData,
            dataType: 'json',
            processData: false,     // Prevent jQuery from processing data
            contentType: false,     // Let browser set content type including boundaries
            headers: {'X-CSRFToken': '{{ csrf_token }}'},

            success: function (response) {
                if(response.status == '1') {
                    window.location.reload(); 
                }
                else{
                    swal('Failed to save Allotment of work to Maintainers')
                    
                }
            },
            error: function () {
                swal('An error occurred while submitting the data.');
            }
        });

      

    });

     $( "#JobEquipmentForm" ).submit(function(e) {
        e.preventDefault();


        var jobequipment_name= $('#jobequipment_name').val()
        var jobequipment_new_no= $('#jobequipment_new_no').val()
        var jobequipment_old_no= $('#jobequipment_old_no').val()
        var JobEquipmentID= $('#JobEquipmentID').val()

        var id= '{{data.id}}';

      

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            dataType: 'json',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            data : {
                'id':id,
                'jobequipment_name' : jobequipment_name,
                'jobequipment_new_no':jobequipment_new_no,
                'jobequipment_old_no':jobequipment_old_no,
                'JobEquipmentID':JobEquipmentID,
                'st':21,
            },

            success: function (response) {
                if(response.status == '1') {
                    window.location.reload(); 
                }
                else{
                    swal('Failed to save Details of the Equipment Replaced')
                    
                }
            }
        });
        


    });

    
    function createNewJobDetails(){
       $('#JobDetailsID').val('');
       $('#job_description').val('');
       $('#s_no').val('');
        myModal.show();
    }

    
    function createNewEquipment(){
        $('#JobEquipmentID').val('');
       $('#jobequipment_name').val('');
       $('#jobequipment_new_no').val('');
       $('#jobequipment_old_no').val('');
        myModal3.show();
    }

    function createNewWork(){
        $('#JobWorkID').val('');
       $('#jobwork_name').val('{{data.logedUsrName}}');
       $('#jobwork_work').val('');
       $('#jobwork_signature').val('');
        myModal2.show();
    }

    function editJobDetails(id,s_no,job_description){

         $('#JobDetailsID').val(id);
       $('#job_description').val(job_description);
       $('#s_no').val(s_no);
        myModal.show();

    }

    function editJobEquipment(id,jobequipment_name,jobequipment_new_no,jobequipment_old_no){

        $('#JobEquipmentID').val(id);
       $('#jobequipment_name').val(jobequipment_name);
       $('#jobequipment_new_no').val(jobequipment_new_no);
       $('#jobequipment_old_no').val(jobequipment_old_no);
        myModal3.show();

    }

    function editJobWork(id,jobwork_name,jobwork_work){

        $('#JobWorkID').val(id);
       $('#jobwork_name').val(jobwork_name);
       $('#jobwork_work').val(jobwork_work);
       
        myModal2.show();

    }

    function deleteJobEquipment(id){

          swal({
            title: "Are you sure?",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "yes, delete it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':22,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });

    }

    
    function deleteJobWork(id){

         swal({
            title: "Are you sure?",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "yes, delete it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':19,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });

    }


    function deleteJobDetails(id){

         swal({
            title: "Are you sure?",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "yes, delete it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':16,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });

    }

    function closeModal(){
       myModal.hide();
    }

     function closeModal2(){
       myModal2.hide();
    }

      function closeModal3(){
       myModal3.hide();
    }

    function editJobCardDetails(){
        var id= '{{data.id}}';

         swal({
            title: "Are you sure?",
            text:"If you update LEVEL 1 Job Card Details, the status of this job card will be reset.",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Ok, update it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':0,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });
    }

    
    function Level1FinalFormRelease(){
        var id= '{{data.id}}';

         swal({
            title: "Are you sure?",
            text:"If you update LEVEL 1 Previous Failure History, the status of this job card will be reset.",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Ok, update it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':28,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });
    }


    function Level2FinalFormRelease(){
        var id= '{{data.id}}';

         swal({
            title: "Are you sure?",
            text:"If you update LEVEL 2 Acceptance of Job Card, the status of this job card will be reset.",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Ok, update it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':27,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });
    }

    
    function editLevel2Equipment(){
        var id= '{{data.id}}';

         swal({
            title: "Are you sure?",
            text:"If you update LEVEL 2 Details of the Equipment Replaced, the status of this job card will be reset.",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Ok, update it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':23,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });
    }

    function editLevel2Completion(){
        var id= '{{data.id}}';

         swal({
            title: "Are you sure?",
            text:"If you update LEVEL 2 Job Completion Report, the status of this job card will be reset.",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Ok, update it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':26,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });
    }


    function editLevel2Close(){
        var id= '{{data.id}}';

         swal({
            title: "Are you sure?",
            text:"If you update LEVEL 2 SIC Completion Report, the status of this job card will be reset.",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Ok, update it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':25,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });
    }

    function editLevel3CloseCard(){

        var id= '{{data.id}}';

        swal({
        title: "Are you sure?",
        text:"If you edit this job card, its status will change from 'Closed' to 'Open'.",
        type: "warning",
        showCancelButton: true,
        confirmButtonClass: "btn-danger",
        confirmButtonText: "Ok, update it!",
        closeOnConfirm: false,
        width: '300px'
        },
        function(){
            $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            dataType: 'json',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            data : {
                'id':id,
                'st':24,
            },
            success: function (response) {
                window.location.reload(); 
            }
        });     
        });

    }
    
    function editLevel2Work(){
        var id= '{{data.id}}';

         swal({
            title: "Are you sure?",
            text:"If you update LEVEL 2 Allotment of work to Maintainers, the status of this job card will be reset.",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Ok, update it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':20,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });
    }
    
    function editDetailsOfJob(){
        var id= '{{data.id}}';

         swal({
            title: "Are you sure?",
            text:"If you update LEVEL 1 Details Of Job(s) to be carried out, the status of this job card will be reset.",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger",
            confirmButtonText: "Ok, update it!",
            closeOnConfirm: false,
            width: '300px'
        },
        function(){
             $.ajax({
                url: "/forms/jobcard_register/addjobcard/",
                method: 'POST',
                dataType: 'json',
                headers: {'X-CSRFToken': '{{ csrf_token }}'},
                data : {
                    'id':id,
                    'st':17,
                },
                success: function (response) {
                    window.location.reload(); 
                }
            });     
        });
    }

    function showRevenueService(){
        var from_revenue_service= $('select[name=from_revenue_service] option').filter(':selected').val()

        if(from_revenue_service == 'Yes'){
            $('#revenue_service_div1').removeClass('d-none')
            $('#revenue_service_div2').removeClass('d-none')
        }else{
            $('#revenue_service_div1').addClass('d-none')
            $('#revenue_service_div2').addClass('d-none')
        }
    }





     $( "#Level1JobCard" ).submit(function(e) {
        e.preventDefault();

        var ohe_required= $('select[name=ohe_required] option').filter(':selected').val()
        var issued_to= $('#issued_to').val()
        var completion_time= $('#completion_time').val()
        var from_revenue_service= $('select[name=from_revenue_service] option').filter(':selected').val()
        var delay_to_service= $('#delay_to_service').val()
        var trip_no= $('#trip_no').val()
        var nature_of_job= $('select[name=nature_of_job] option').filter(':selected').val()
        var event_date= $('#event_date').val()
        var event_time= $('#event_time').val()

      
        var id= '{{data.id}}';

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            dataType: 'json',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            data : {
               
                'id':id,
                'ohe_required' : ohe_required,
                'issued_to':issued_to,
                'completion_time':completion_time,
                'from_revenue_service':from_revenue_service,
                'delay_to_service':delay_to_service,
                'trip_no':trip_no,
                'nature_of_job':nature_of_job,
                'event_date':event_date,
                'event_time':event_time,
                'st':1,
            },

            success: function (response) {
                if(response.status == '1') {
                    window.location.reload(); 
                }
                else{
                    swal('Failed to update LEVEL 1 Job Card Details (To be filled by PPIO) (Pune Metro)')
                    
                }
            }
        });
        
    });


    $( "#Level1SafetyIndependent" ).submit(function(e) {
        e.preventDefault();

        var sic_required= $('select[name=sic_required] option').filter(':selected').val()
        var assigned_to= $('#assigned_to').val()
        var sic_no= $('#sic_no').val()
       
        var id= '{{data.id}}';

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            dataType: 'json',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            data : {
               
                'id':id,
                'sic_required' : sic_required,
                'assigned_to':assigned_to,
                'sic_no':sic_no,
                'st':2,
            },

            success: function (response) {
                if(response.status == '1') {
                    window.location.reload(); 
                }
                else{
                    swal('Failed to update LEVEL 1 Safety Independent Check Required (To be decided by PPIO)')
                    
                }
            }
        });
        
    });

    
     $("#Level2WorkForm").submit(function(e) {
        e.preventDefault();

        var form = $('#Level2WorkForm')[0];  // Get the raw DOM form element
        var formData = new FormData(form);    // Create FormData object

        formData.append('id', '{{ data.id }}');
        formData.append('st', 5);

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            data: formData,
            dataType: 'json',
            processData: false,     // Prevent jQuery from processing data
            contentType: false,     // Let browser set content type including boundaries
            headers: {'X-CSRFToken': '{{ csrf_token }}'},

            success: function (response) {
                if (response.status == '1') {
                    window.location.reload();
                } else {
                    swal('Failed to update LEVEL 2 Details of the activities carried out');
                }
            },
            error: function () {
                swal('An error occurred while submitting the data.');
            }
        });
    });



    $("#Level1FinalForm").submit(function(e) {
        e.preventDefault();

        var form = $('#Level1FinalForm')[0];  // Get the raw DOM form element
        var formData = new FormData(form);    // Create FormData object

        formData.append('id', '{{ data.id }}');
        formData.append('st', 3);

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            data: formData,
            dataType: 'json',
            processData: false,     // Prevent jQuery from processing data
            contentType: false,     // Let browser set content type including boundaries
            headers: {'X-CSRFToken': '{{ csrf_token }}'},

            success: function (response) {
                if (response.status == '1') {
                    window.location.reload();
                } else {
                    swal('Failed to update LEVEL 1 Previous Failure History (To be filled by PPIO) (Pune Metro)');
                }
            },
            error: function () {
                swal('An error occurred while submitting the data.');
            }
        });
    });



    $("#Level2FinalForm").submit(function(e) {
        e.preventDefault();

        var form = $('#Level2FinalForm')[0];  // Get the raw DOM form element
        var formData = new FormData(form);    // Create FormData object

        formData.append('id', '{{ data.id }}');
        formData.append('st', 4);

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            data: formData,
            dataType: 'json',
            processData: false,     // Prevent jQuery from processing data
            contentType: false,     // Let browser set content type including boundaries
            headers: {'X-CSRFToken': '{{ csrf_token }}'},

            success: function (response) {
                if (response.status == '1') {
                    window.location.reload();
                } else {
                    swal('Failed to update LEVEL 2 Acceptance of Job Card (To be filled by nominated work supervisor)');
                }
            },
            error: function () {
                swal('An error occurred while submitting the data.');
            }
        });
    });


     $("#Level2EquipmentForm").submit(function(e) {
        e.preventDefault();

        var form = $('#Level2EquipmentForm')[0];  // Get the raw DOM form element
        var formData = new FormData(form);    // Create FormData object

        formData.append('id', '{{ data.id }}');
        formData.append('st', 6);

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            data: formData,
            dataType: 'json',
            processData: false,     // Prevent jQuery from processing data
            contentType: false,     // Let browser set content type including boundaries
            headers: {'X-CSRFToken': '{{ csrf_token }}'},

            success: function (response) {
                if (response.status == '1') {
                    window.location.reload();
                } else {
                    swal('Failed to update LEVEL 2 Job Completion Report');
                }
            },
            error: function () {
                swal('An error occurred while submitting the data.');
            }
        });
    });


     $("#Level2CompletionForm").submit(function(e) {
        e.preventDefault();

        var form = $('#Level2CompletionForm')[0];  // Get the raw DOM form element
        var formData = new FormData(form);    // Create FormData object

        formData.append('id', '{{ data.id }}');
        formData.append('st', 7);

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            data: formData,
            dataType: 'json',
            processData: false,     // Prevent jQuery from processing data
            contentType: false,     // Let browser set content type including boundaries
            headers: {'X-CSRFToken': '{{ csrf_token }}'},

            success: function (response) {
                if (response.status == '1') {
                    window.location.reload();
                } else {
                    swal('Failed to update LEVEL 2 Job Completion Report');
                }
            },
            error: function () {
                swal('An error occurred while submitting the data.');
            }
        });
    });



     $("#Level3CompletionForm").submit(function(e) {
        e.preventDefault();

        var form = $('#Level3CompletionForm')[0];  // Get the raw DOM form element
        var formData = new FormData(form);    // Create FormData object

        formData.append('id', '{{ data.id }}');
        formData.append('st', 8);

        $.ajax({
            url: "/forms/jobcard_register/addjobcard/",
            method: 'POST',
            data: formData,
            dataType: 'json',
            processData: false,     // Prevent jQuery from processing data
            contentType: false,     // Let browser set content type including boundaries
            headers: {'X-CSRFToken': '{{ csrf_token }}'},

            success: function (response) {
                if (response.status == '1') {
                    window.location.reload();
                } else {
                    swal('Failed to update LEVEL 2 Job Completion Report');
                }
            },
            error: function () {
                swal('An error occurred while submitting the data.');
            }
        });
    });


   
</script>

{% endblock sb_admin_js %}
