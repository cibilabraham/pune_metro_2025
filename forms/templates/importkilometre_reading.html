

{% extends "django_sb_admin/base.html" %}
<!doctype html>
{% block sb_admin_header %}
  {% block branding %}
    <img src="/static/Riyadh-metro-logo.png" style="background: transparent;width: 60px;">
    <!-- <h1 id="site-name">Asset Optima</h1> -->
    <style>
        th:first-child,td:first-child,th:last-child,td:last-child {  
        background-color:white;    
        }
    </style>
  {% endblock %}
{% endblock sb_admin_header %}
{% block sb_admin_content %}
              <!-- Page Heading -->
            {% if status %}
            <div class="row mb-3 mb-4 mt-4">
                <div class="col-lg-12">
                    <h3 class="page-header">
                        Import Daily Kilometre Reading
                    </h3>
                    <!--ol class="breadcrumb">
                        <li>
                            <i class="fa fa-dashboard"></i>  <a href="index.html">Dashboard</a>
                        </li>
                        <li class="active">
                            <i class="fa fa-edit"></i> Forms
                        </li>
                    </ol-->
                </div>
            </div>
            <div class="row ">
                <div class="col-lg-12 mb-5">
                    
                    
                        <button class="btn btn-success btn-icon-split float-right m-2" onclick="getIdofSelectedCBAssetReg({{data}})">            
                        <span class="text">Save </span>
                        
                        </button>

                        <a href="/forms/kilometre_reading/"><button class="btn btn-primary btn-icon-split float-right m-2" > 
                            <span class="icon text-white-50">
                                <i class="fas fa-angle-left"></i>
                                </span>             
                            <span class="text">Back</span>
                            </button></a>
                        
                   
                </div>
            </div>

                <div class="row">
                  <div class="col-md-12">
                      <table id="importDataUpdate" class="table table-striped table-bordered " style="width:100%">
                          <thead>
                              <tr>
                                    <th><input type="checkbox" id="SACB_importAssetRegister" /></th>
                                    <th>Date</th>
                                    <th>TS#01</th>
                                    <th>TS#02</th>
                                    <th>TS#03</th>
                                    <th>TS#04</th>
                                    <th>TS#05</th>
                                    <th>TS#06</th>
                                    <th>TS#07</th>
                                    <th>TS#08</th>
                                    <th>TS#09</th>
                                    <th>TS#10</th>
                                    <th>TS#11</th>
                                    <th>TS#12</th>
                                    <th>TS#13</th>
                                    <th>TS#14</th>
                                    <th>TS#15</th>
                                    <th>TS#16</th>
                                    <th>TS#17</th>
                                    <th>TS#18</th>
                                    <th>TS#19</th>
                                    <th>TS#20</th>
                                    <th>TS#21</th>
                                    <th>TS#22</th>
                                    <th>TS#23</th>
                                    <th>TS#24</th>
                                    <th>TS#25</th>
                                    <th>TS#26</th>
                                    <th>TS#27</th>
                                    <th>TS#28</th>
                                    <th>TS#29</th>
                                    <th>TS#30</th>
                                    <th>TS#31</th>
                                    <th>TS#32</th>
                                    <th>TS#33</th>
                                    <th>TS#34</th>
                                    <th></th>
                              </tr>
                          </thead>
                          <tbody>
                            {% for dU in data %}
                                <tr>
                                    <td>
                                        {% if dU.err_status == '1' %}
                                            <input type="checkbox" value="{{dU.id}}" name="CB_importData" class="CB_importAssetRegister"/>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.date}}
                                        {% if dU.date_err != '1' %}
                                            <span class="text-danger"><br>{{dU.date_err}}</span>
                                        {% endif %}
                                    </td>

                                    
                                    <td>{{dU.TS01}}
                                        {% if dU.TS01_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS01_err}}</span>
                                        {% endif %}
                                    </td>
                                     <td>{{dU.TS02}}
                                        {% if dU.TS02_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS02_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS03}}
                                        {% if dU.TS03_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS03_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS04}}
                                        {% if dU.TS04_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS04_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS05}}
                                        {% if dU.TS05_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS05_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS06}}
                                        {% if dU.TS06_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS06_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS07}}
                                        {% if dU.TS07_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS07_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS08}}
                                        {% if dU.TS08_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS08_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS09}}
                                        {% if dU.TS09_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS09_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS10}}
                                        {% if dU.TS10_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS10_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS11}}
                                        {% if dU.TS11_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS11_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS12}}
                                        {% if dU.TS12_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS12_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS13}}
                                        {% if dU.TS13_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS13_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS14}}
                                        {% if dU.TS14_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS14_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS15}}
                                        {% if dU.TS15_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS15_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS16}}
                                        {% if dU.TS16_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS16_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS17}}
                                        {% if dU.TS17_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS17_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS18}}
                                        {% if dU.TS18_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS18_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS19}}
                                        {% if dU.TS19_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS19_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS20}}
                                        {% if dU.TS20_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS20_err}}</span>
                                        {% endif %}
                                    </td>

                                    <td>{{dU.TS21}}
                                        {% if dU.TS21_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS21_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS22}}
                                        {% if dU.TS22_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS22_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS23}}
                                        {% if dU.TS23_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS23_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS24}}
                                        {% if dU.TS24_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS24_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS25}}
                                        {% if dU.TS25_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS25_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS26}}
                                        {% if dU.TS26_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS26_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS27}}
                                        {% if dU.TS27_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS27_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS28}}
                                        {% if dU.TS28_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS28_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS29}}
                                        {% if dU.TS29_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS29_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.TS30}}
                                        {% if dU.TS30_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS30_err}}</span>
                                        {% endif %}
                                    </td>
                                     <td>{{dU.TS31}}
                                        {% if dU.TS31_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS31_err}}</span>
                                        {% endif %}
                                    </td>
                                     <td>{{dU.TS32}}
                                        {% if dU.TS32_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS32_err}}</span>
                                        {% endif %}
                                    </td>
                                     <td>{{dU.TS33}}
                                        {% if dU.TS33_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS33_err}}</span>
                                        {% endif %}
                                    </td>
                                     <td>{{dU.TS34}}
                                        {% if dU.TS34_err != '1' %}
                                            <span class="text-danger"><br>{{dU.TS34_err}}</span>
                                        {% endif %}
                                    </td>



                                    <td>
                                        {% if dU.err_status == '1' %}
                                            <span class="text-success"><i class="fas fa-check"></i></span>
                                        {% else %}
                                            <span class="text-danger"><i class="fas fa-times"></i></span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}

                                
                                
                          </tbody>
                      </table>
                  </div>
                </div>

                <div class="row mb-4" align="right">
                    <div class="col-12">  
                        <button type="button" onclick="getIdofSelectedCBAssetReg({{data}})" class="btn btn-success" >Save</button>
                    </div>
                </div>


            {% else %}

            <div class="row mb-3">
                <div class="col-lg-12">
                    <h3 class="page-header">
                      Import Daily Kilometre Reading
                    </h3>
                   
                </div>
            </div>

            <div class="row ">
                <div class="col-lg-12 mb-3">
    
    
                    <a href="/forms/kilometre_reading/"><button class="btn btn-primary btn-icon-split float-right m-2" > 
                    <span class="icon text-white-50">
                        <i class="fas fa-angle-left"></i>
                        </span>             
                    <span class="text">Back</span>
                    </button></a>
                
                </div>
            </div>


            <form  enctype='multipart/form-data' action="/forms/kilometre_reading/importkilometre_reading/"  id="importassetregister" name="importassetregister" method="post" > 
            <!-- <form  enctype='multipart/form-data' id="importassetregister" name="importassetregister" method="post" >  -->

                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                <div class="card card-login mx-auto mt-5">
                    <h2 class="card-header text-center">Import File</h2>
                <div class="card-body">
                    <fieldset class="module aligned uploadFileForm">
                        <div class="form-row">
                        <label for="import_file">File to import:</label>
                        <input type="file" name="import_assetRegister" required="" id="import_assetRegister">
                        </div>
                    </fieldset>
                    <div>
                        {% if message %}
                            <div class="alert alert-warning m-2">
                            {{message}}
                            </div>
                        {% else %}
                            <div class="alert alert-warning m-2">
                            *Don't include space for the uploaded filename
                            </div>
                        {% endif %}
                    </div>
                    <div class="">
                        <input type="submit" class="btn btn-success float-right" value="Submit">
                        
                    </div>
                    
                
                </div>
            </form>

        </div>
        <div class="row mt-5">
            <div class="mx-auto" style="max-width: 20rem;">
            <a class="btn btn-primary" href="/static/AssetRegister.xlsx " download="">Download Sample Excel File</a>
        </div>
        {% endif %}


            
{% endblock sb_admin_content %}
{% block sb_admin_js %}
<script>
$(document).ready(function() {
    $("#SACB_importAssetRegister").click(function () {
        $(".CB_importAssetRegister").attr('checked', this.checked);
    });
    $('#importDataUpdate').DataTable({
        scrollY:        "350px",
        scrollX:        true,
        scrollCollapse: true,
        paging:         false,
        fixedColumns:   {
            left: 1,
            right: 1
        },
        "searching" : false,
        "order": false,
    });
});

 
function getids(){
    ids1=[];
    $("input:checkbox[name=CB_importData]:checked").each(function(){
        ids1.push($(this).val());
    });

    // return ids1;
    return ids1.toString();
}

function getIdofSelectedCBAssetReg(data1){
    ids= getids();
    if (ids == ""){
        swal("Please select atleast one record");
        return false;
    }
    var datas=data1;
    $.ajax({
        url: "/forms/kilometre_reading/addimportkilometre_reading/",
        method: 'POST',
        dataType: 'json',
        headers: {'X-CSRFToken': '{{ csrf_token }}'},
        data: {
            'ids':ids ,
            'datas': JSON.stringify(datas),
        },
        success: function (response) {
            if(response.status == '1') {
                // swal(" Inserted :  " + response.inserted + " Records and Updated :  " + response.updated +" Records");
                // window.location.href = '/forms/asset_register/';

                swal({
                    title: " Inserted :  " + response.inserted + " Records and Updated :  " + response.updated +" Records",
                    text: "",
                    type: '',
                    showCancelButton: false,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ok'
                },function () {
                    window.location.href = '/forms/kilometre_reading/';
                })  
            }
                
        }
    });
}



    
</script>

{% endblock sb_admin_js %}
