

{% extends "django_sb_admin/base.html" %}
<!doctype html>
{% block sb_admin_header %}
  {% block branding %}
    <img src="/static/Riyadh-metro-logo.png" style="background: transparent;width: 60px;">
    <style>
        th:first-child,td:first-child,th:last-child,td:last-child {  
        background-color:white;    
        }
    </style>
    <!-- <h1 id="site-name">Asset Optima</h1> -->
  {% endblock %}
{% endblock sb_admin_header %}
{% block sb_admin_content %}
              <!-- Page Heading -->
            {% if status %}
            <div class="row mb-3 mb-4 mt-4">
                <div class="col-lg-12">
                    <h3 class="page-header">
                        Import Failure Data
                    </h3>
                    <!--ol class="breadcrumb">
                        <li>
                            <i class="fa fa-dashboard"></i>  <a href="index.html">Dashboard</a>
                        </li>
                        <li class="active">
                            <i class="fa fa-edit"></i> Forms
                        </li>
                    </ol-->
                </div>
            </div>
            <div class="row ">
                <div class="col-lg-12 mb-5">
                    
                    
                        <button class="btn btn-success btn-icon-split float-right m-2" onclick="getIdofSelectedfailuredata({{data}})">            
                        <span class="text">Save </span>
                        
                        </button>

                        <a href="/forms/failuredata/"><button class="btn btn-primary btn-icon-split float-right m-2" > 
                            <span class="icon text-white-50">
                                <i class="fas fa-angle-left"></i>
                                </span>             
                            <span class="text">Back</span>
                            </button></a>
                   
                </div>
            </div>


             

                <div class="row">
                  <div class="col-md-12">
                      <table id="importDataUpdate" class="table table-striped table-bordered " style="width:100%">
                          <thead>
                              <tr>
                                    <th><input type="checkbox" id="SACB_importAssetRegister" /></th>
                                    <th>failure_id</th>
                                    <th>asset type</th>
                                    <th>asset_config id</th>
                                    <th>event description</th>
                                    <th>mode id</th>
                                    <th>date</th>
                                    <th>time</th>
                                    <th>detection</th>
                                    <th>service delay</th>
                                    <th>immediate investigation</th>
                                    <th>failure type</th>
                                    <th>safety failure</th>
                                    <th>hazard id</th>
                                    <th>cm description</th>
                                    <th>replaced asset config id</th>
                                    <th>cm start date</th>
                                    <th>cm start time</th>
                                    <th>cm end date</th>
                                    <th>cm end time</th>
                                    <th>oem failure reference</th>
                                    <th>defect</th>

                                    <th>Error</th>
                              </tr>
                          </thead>
                          <tbody>
                            {% for dU in data %}
                                <tr>
                                    <td>
                                        {% if dU.err_status == '1' %}
                                            <input type="checkbox" value="{{dU.id}}" name="CB_importData" class="CB_importAssetRegister"/>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.failure_id}}
                                        {% if dU.failure_id_err != '1' %}
                                        <span class="text-danger"><br>{{dU.failure_id_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.asset_type}}
                                        {% if dU.asset_type_err != '1' %}
                                        <span class="text-danger"><br>{{dU.asset_type_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.asset_config_id}}
                                        {% if dU.asset_config_id_err != '1' %}
                                        <span class="text-danger"><br>{{dU.asset_config_id_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.event_description}}
                                        {% if dU.event_description_err != '1' %}
                                        <span class="text-danger"><br>{{dU.event_description_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.mode_id}}
                                        {% if dU.mode_id_err != '1' %}
                                        <span class="text-danger"><br>{{dU.mode_id_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.date}}
                                        {% if dU.date_err != '1' %}
                                        <span class="text-danger"><br>{{dU.date_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.time}}
                                        {% if dU.time_err != '1' %}
                                        <span class="text-danger"><br>{{dU.time_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.detection}}
                                        {% if dU.detection_err != '1' %}
                                        <span class="text-danger"><br>{{dU.detection_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.service_delay}}
                                        {% if dU.service_delay_err != '1' %}
                                        <span class="text-danger"><br>{{dU.service_delay_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.immediate_investigation}}
                                        {% if dU.immediate_investigation_err != '1' %}
                                        <span class="text-danger"><br>{{dU.immediate_investigation_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.failure_type}}
                                        {% if dU.failure_type_err != '1' %}
                                        <span class="text-danger"><br>{{dU.failure_type_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.safety_failure}}
                                        {% if dU.safety_failure_err != '1' %}
                                        <span class="text-danger"><br>{{dU.safety_failure_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.hazard_id}}
                                        {% if dU.hazard_id_err != '1' %}
                                        <span class="text-danger"><br>{{dU.hazard_id_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.cm_description}}
                                        {% if dU.cm_description_err != '1' %}
                                        <span class="text-danger"><br>{{dU.cm_description_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.replaced_asset_config_id}}
                                        {% if dU.replaced_asset_config_id_err != '1' %}
                                        <span class="text-danger"><br>{{dU.replaced_asset_config_id_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.cm_start_date}}
                                        {% if dU.cm_start_date_err != '1' %}
                                        <span class="text-danger"><br>{{dU.cm_start_date_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.cm_start_time}}
                                        {% if dU.cm_start_time_err != '1' %}
                                        <span class="text-danger"><br>{{dU.cm_start_time_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.cm_end_date}}
                                        {% if dU.cm_end_date_err != '1' %}
                                        <span class="text-danger"><br>{{dU.cm_end_date_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.cm_end_time}}
                                        {% if dU.cm_end_time_err != '1' %}
                                        <span class="text-danger"><br>{{dU.cm_end_time_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.oem_failure_reference}}
                                        {% if dU.oem_failure_reference_err != '1' %}
                                        <span class="text-danger"><br>{{dU.oem_failure_reference_err}}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{dU.defect}}
                                        {% if dU.defect_err != '1' %}
                                        <span class="text-danger"><br>{{dU.defect_err}}</span>
                                        {% endif %}
                                    </td>
                                   
                                    <td>
                                        {% if dU.err_status == '1' %}
                                            <span class="text-success"><i class="fas fa-check"></i></span>
                                        {% else %}
                                            <span class="text-danger"><i class="fas fa-times"></i></span>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}

                                
                                
                          </tbody>
                      </table>
                  </div>
                </div>

                <div class="row mb-4" align="right">
                    <div class="col-12">  
                        <button type="button" onclick="getIdofSelectedfailuredata({{data}})" class="btn btn-success" >Save</button>
                    </div>
                </div>



            {% else %}

            <div class="row mb-3">
                <div class="col-lg-12">
                    <h3 class="page-header">
                      Import Failure Data
                    </h3>
                   
                </div>
            </div>

            <div class="row ">
                <div class="col-lg-12 mb-3">
    
    
                    <a href="/forms/failuredata/"><button class="btn btn-primary btn-icon-split float-right m-2" > 
                    <span class="icon text-white-50">
                        <i class="fas fa-angle-left"></i>
                        </span>             
                    <span class="text">Back</span>
                    </button></a>
                
                </div>
            </div>


            <form  enctype='multipart/form-data' action="/forms/failuredata/importfailuredata/"  id="importassetregister" name="importassetregister" method="post" > 
            <!-- <form  enctype='multipart/form-data' id="importassetregister" name="importassetregister" method="post" >  -->

                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                <div class="card card-login mx-auto mt-5">
                    <h2 class="card-header text-center">Import File</h2>
                <div class="card-body">
                    <fieldset class="module aligned uploadFileForm">
                        <div class="form-row">
                        <label for="import_file">File to import:</label>
                        <input type="file" name="import_failureData" required="" id="import_failureData">
                        </div>
                    </fieldset>
                    <div>
                        {% if message %}
                            <div class="alert alert-warning m-2">
                            {{message}}
                            </div>
                        {% else %}
                            <div class="alert alert-warning m-2">
                            *Don't include space for the uploaded filename
                            </div>
                        {% endif %}
                    </div>
                    <div class="">
                        <input type="submit" class="btn btn-success float-right" value="Submit">
                        
                    </div>
                </div>
            </form>

        </div>
        <div class="row mt-5">
            <div class="mx-auto" style="max-width: 20rem;">
            <a class="btn btn-primary" href="/static/ImportFailureData.xlsx " download="">Download Sample Excel File</a>
        </div>
        {% endif %}


            
{% endblock sb_admin_content %}
{% block sb_admin_js %}
<script>
$(document).ready(function() {
    $('#importDataUpdate').DataTable({
        scrollY:        "350px",
        scrollX:        true,
        scrollCollapse: true,
        paging:         false,
        fixedColumns:   {
            left: 1,
            right:1
        },
        "ordering": false,
        "searching" : false,
    });
    $('#importDataAdd').DataTable({
        scrollY:        "350px",
        scrollX:        true,
        scrollCollapse: true,
        paging:         false,
        fixedColumns:   {
            left: 1,
            right:1
        },
        "ordering": false,
        "searching" : false,
    });
    $("#SACB_importAssetRegister").click(function () {
        $(".CB_importAssetRegister").attr('checked', this.checked);
    });
});

 
function getids(){
    ids1=[];
    $("input:checkbox[name=CB_importData]:checked").each(function(){
        ids1.push($(this).val());
    });

    // return ids1;
    return ids1.toString();
}

function getIdofSelectedfailuredata(data1){
    ids= getids();
    if (ids == ""){
        swal("Please select atleast one record");
        return false;
    }
    var datas=data1;
    $.ajax({
        url: "/forms/failuredata/addimportfailuredata/",
        method: 'POST',
        dataType: 'json',
        headers: {'X-CSRFToken': '{{ csrf_token }}'},
        data: {
            'ids':ids,
            'datas': JSON.stringify(datas),
         },
        success: function (response) {
            if(response.status == '1') {
                // swal(" Inserted :  " + response.inserted + " Records and Updated :  " + response.updated +" Records");
                // window.location.href = '/forms/failuredata/';

                swal({
                    title: " Inserted :  " + response.inserted + " Records and Updated :  " + response.updated +" Records",
                    text: "",
                    type: '',
                    showCancelButton: false,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ok'
                },function () {
                    window.location.href = '/forms/failuredata/';
                })  
            }
                
        }
    });
}



    
</script>

{% endblock sb_admin_js %}
